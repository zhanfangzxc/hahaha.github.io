---
layout: post
title: "Realm用法"
date: 2014-09-21 14:20:40 +0800
comments: true
categories: Android
---

**Realm使用方法**

> 在Android Studio中使用Realm

- 下载 ```http://realm.io/docs/java/0.70.1/ ```该网站上的Realm压缩包
- 在 Android Studio中创建Android项目
- 复制压缩包中的```realm```文件夹到你所创建的项目的根目录下
- 复制压缩包中的```realm-annotations-processor-VERSION.jar```文件到app/libs目录下
- 在所创建的根目录下的settings.gradle文件下，添加下面一行代码-	->
	```
	include ':realm'
	```
- 在所创建的项目的根目录中的build.gradle文件中添加下面一行代码

	```
	classpath 'com.meenbedankt.gradle:plugins:android-apt:1.4'
	```
- 在所创建的项目的app/build.gradle文件中添加如下代码

	```
	apply plugin: 'com.neenbedankt.android-apt'
	```
	
- 替换所创建的项目中的app/build.gradle文件下的dependencies节点

	```
	dependencies{
		apt fileTree(dir: 'libs',include: ['*.jar'])
		compile project(':realm')
	}
	```
	
- 最后一步：执行如下操作```Tools->Android->Sync Project with Gradle Filse```
- 接着就可以在你的项目中使用Realm了
<!--more-->
> 具体在项目中的使用方法

- 创建```Models```需要继承```RealmObject```
- Realm支持如下数据类型：```boolean```, ```short```, ```ìnt```, ```long```, ```float```, ```double```, ```String```, ```Date and byte[]```. Moreover, ```subclasses of RealmObject ```and ```RealmList```
- 如果在某个字段上添加```@Ignore```注解的话，这个字段的值将不会被存储

> Writes
		
```
Realm realm = Realm.getInstance(this);
realm.beginTransaction();//开启事务
//添加或者更新Object操作在此处实现
realm.commitTransaction();//提交事务


```
	
```
// Obtain a Realm instance
Realm realm = Realm.getInstance(this);

realm.beginTransaction();
User user = realm.createObject(User.class); // Create a new object
user.setName("John");
user.setEmail("john@corporation.com");
realm.commitTransaction();

```
	
> Queries(查询)

```
// Build the query looking at all users:
RealmQuery<User> query = realm.where(User.class);

// Add query conditions:
query.equalTo("name", "John");
query.or().equalTo("name", "Peter");

// Execute the query:
RealmResults<User> result1 = query.findAll();

// Or alternatively do the same at ones (the "Fluent interface"):						      
RealmResults<User> result2 = realm.where(User.class).equalTo("name", "John").or().equalTo("name", "Peter").findAll();
```

- 查询中可以附加的条件

	- ```greaterThan()```, ```lessThan()```, ```greateThanOrEqualTo()``` & ```lessThanOrEqualTo()```
	- ```equalTo()``` & ```notEqualTo()```
	- ```contains()```, ```beginsWith()``` & ```endsWith()```
	
> Logical Operators

```
RealmResults<User> r = realm.where(User.class).greaterThan("age", 10)  //implicit AND
.beginGroup().equalTo("name", "Peter")
.or().contains("name", "Jo").endGroup().findAll();

```
> Sorting(排序)

```
RealmResults<User> result = realm.where(User.class).findAll();
RealmResults<User> sortedAscending  = result.sort("age");
RealmResults<User> sortedDescending = result.sort("age", RealmResults.SORT_ORDER_DECENDING);
```

> Chaining Queries(查询链)：就是在上一次查询的结果中进行第二次，第三次。。。的查询

```
RealmResults<User> teenagers = Realm.where(User.class).between("age", 13, 20).findAll();
RealmResults<User> firstJohn = teenagers.where().equalTo("name", "John").findFirst();
```

> Aggregation 集合

- RealmResults还有很多集合的方法

```
long   sum     = result.sum("age").longValue();
long   min     = result.min("age").longValue();
long   max     = result.max("age").longValue();
double average = result.average("age");

```

> Iterations 遍历查询结果

- 可以通过以下方法遍历```RealmResults```

```
for (User u : result) {
    // ... do something with the object ...
}
```
或者

```
for (int i = 0; i < result.size(); i++) {
    User u = result.get(i);
    // ... do something with the object ...
}
```

> Delete 删除操作

	// All changes to data must happen in a 	transaction
	realm.beginTransaction();
	
	// remove single match
	result.remove(0);
	result.removeLast();

	// Delete all matches
	result.clear();

	realm.endTransaction()

> Realms

- 默认的Realm```Realm.getInstance(this)```
- ```Realm realm = Realm.getInstance(this, "allmymovies.realm");```

> RelationShips 建立关系

	public class Email extends RealmObject {
    private String address;
	    // ... setters and getters left out
	}

	public class Contact extends RealmObject {
    	private String name;
    	private Email email;
    	// ... setters and getters left out
	}
	
- Many-to-One 多对一

		public class Email extends RealmObject {
    		private Contact contact;
    		// Other fields…
		}


- Many-to-Many

		public class Contact extends RealmObject {
    		private RealmList<Email> emails;
    		// Other fields…
		}	
		
> Notifications

	realm.addChangeListener(new RealmChangeListener() {
    @Override
    public void onChange() {
        // ... do something with the updates (UI, etc.) ...
    }
	});
	
	//关闭listeners
	realm.removeAllChangeListeners();





		


	