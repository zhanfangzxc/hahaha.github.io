title: 反编译总结
date: 2016-02-18 14:20:40
tags:
- Android
- 反编译

---
### 反编译代码

#### 工具

- dex2jar 用于将dex文件转换成jar文件

  下载地址:[http://sourceforge.net/projects/dex2jar/files/](http://sourceforge.net/projects/dex2jar/files/)
  
- jd-gui 用于将jar文件转换成java代码

	下载地址：[http://jd.benow.ca/](http://jd.benow.ca/)
	
#### 操作步骤

- 将准备好的APK包解压，如果无法解压，可以将后缀换成.zip
- 将dex文件转换成jar文件

		./d2j-dex2jar.sh qq.apk
		
- 使用jd-gui查看jar文件

### 反编译资源

#### 工具

- apktool 用于还原APK文件中的9-patch图片，布局，字符串等资源

	下载地址：[http://ibotpeaches.github.io/Apktool/install/](http://ibotpeaches.github.io/Apktool/install/)
	
#### 操作步骤

	apktool d qq.apk
	
d是decode的意思，以下是一些附加参数：

- -f 强制删除已经存在的文件夹
- -o 指定文件夹的名称
- -s 不反编译dex文件
- -r 不反编译资源文件

### 重新打包

![编译后的包目录](http://img.blog.csdn.net/20160208234027946)

- original 存放的是未经反编译过的原始清单文件
- res 反编译后的资源文件
- smali 反编译后的代码文件

- 打包APK

		apktool b apk文件夹 -o 打包后的APK名字

- 签名

		jarsingner -verbose -sigalg SHA1withRSA -digestalg SHA1 -keystore 签名文件名 -storepass 签名密码 待签名的APK文件名 签名的别名
		
- 对齐操作

		zipalign 4 待对齐APK文件名 对齐后的文件名

#### 系统的混淆规则

- 混淆还可以压缩代码，将没有用到的方法等都给移除掉
- 凡是需要在AndroidManifest.xml中注册的所有类的类名以及从负累重写的方法名都不会被混淆。
- 类中存在被native声明的方法，就不会被混淆 		
#### 混淆jar包

- 第一步，将Class文件打成jar包

		jar -cvf androidTest.jar -C app/buildintermediate/classes/debug
		
- 第二步，在<Android SDK>/tools/proguard/bin目录下能够看到如下文件

![打包工具](http://img.blog.csdn.net/20160310231053316)

- 用***sh proguardgui.sh*** 打开混淆工具

### 参考文章

[郭霖-Android安全攻防战，反编译与混淆技术完全解析(上)](http://blog.csdn.net/guolin_blog/article/details/49738023)

[腾讯应用加固的脱壳分析和修复](http://www.mak-blog.com/tencent-shell-crack.html)

[Android混淆技术](http://blog.csdn.net/guolin_blog/article/details/50451259)

		