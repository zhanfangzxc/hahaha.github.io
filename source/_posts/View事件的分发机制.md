title: View事件的分发机制
date: 2016-02-29 15:35:26
tags:
- Android

---

### 点击事件的传递规则

点击事件的分发过程有三个很重要的方法来共同完成，**dispatchTouchEvent()**、**onInterceptTouchEvent()**、**onTouchEvent()**.

- public boolean dispatchTouchEvent(MotionEvent ev)

用来进行事件的分发，如果事件能够传递给当前的View，那么此方法一定会被调用，返回结果受当前View的onTouchEvent和下级View的dispatchTouchEvent方法的影响，表示是否消耗当前事件。

- public boolean onInterceptTouchEvent(MotionEvent ev)

用来判断是否拦截某个事件，如果当前View拦截了某个事件，那么再同一个事件序列中，此方法不会被再次调用，返回结果表示是否拦截当前事件。

- public boolean onTouchEvent(MotionEvent event)

在dispatchTouchEvent方法中调用，用来处理点击事件，返回结果表示是否消耗当前事件，如果不消耗，则在同一个事件序列中，当前View无法再次接收到事件。

### 传递机制

对于一个根View来说，点击事件产生后，他的dispatchEvent方法会被调用，如果该ViewGroup的onInterceptTouchEvent返回true，就表示要拦截该事件，接着就交给ViewGroup的onTouchEvent方法处理，如果onInterceptTouchEvent返回false,这个事件就会传递给子元素，接着子元素的dispatchTouchEvent就会被调用。

如果一个View需要处理事件的时候，当他设置了onTouchListener,那么onTouchListener的onTouch方法会被调用，这时事件的处理要看onTouch的返回值，返回true，onTouchEvent将不会被调用，返回false，当前view的onTouchEvent会被调用，所以onTouchListener优先级比onTouchEvent要高，而OnClickListener优先级最低。

- 点击事件传递过程：Activity -> Window -> View

- requestDisallowInterceptTouchEvent方法可以在子元素中干预父元素的事件分发过程，但是ACTION_DOWN事件除外。












































































































































































































































































































































































































































