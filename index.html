<!doctype html>
<html class="theme-next use-motion ">
<head>
  

<meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>


<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />








  <link rel="stylesheet" type="text/css" href="/vendors/fancybox/source/jquery.fancybox.css?v=2.1.5"/>



  <link href='//fonts.googleapis.com/css?family=Lato:300,400,700,400italic&subset=latin,latin-ext' rel='stylesheet' type='text/css'>


<link rel="stylesheet" type="text/css" href="/css/main.css?v=0.4.5.1"/>


    <meta name="description" content="既然选择远方，便只顾风雨兼程" />



  <meta name="keywords" content="Hexo,next" />



  <link rel="alternate" href="/atom.xml" title="ZhaoShanShan’s Blog" type="application/atom+xml" />



  <link rel="shorticon icon" type="image/x-icon" href="/favicon.ico?v=0.4.5.1" />


<meta name="description" content="既然选择远方，便只顾风雨兼程">
<meta property="og:type" content="website">
<meta property="og:title" content="ZhaoShanShan’s Blog">
<meta property="og:url" content="http://zhaoshanshan.me/index.html">
<meta property="og:site_name" content="ZhaoShanShan’s Blog">
<meta property="og:description" content="既然选择远方，便只顾风雨兼程">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="ZhaoShanShan’s Blog">
<meta name="twitter:description" content="既然选择远方，便只顾风雨兼程">


<script type="text/javascript" id="hexo.configuration">
  var CONFIG = {
    scheme: '',
    sidebar: 'always'
  };
</script>

  <title> ZhaoShanShan’s Blog </title>
</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-CN">

  <!--[if lte IE 8]>
  <div style=' clear: both; height: 59px; padding:0 0 0 15px; position: relative;margin:0 auto;'>
    <a href="http://windows.microsoft.com/en-US/internet-explorer/products/ie/home?ocid=ie6_countdown_bannercode">
      <img src="http://7u2nvr.com1.z0.glb.clouddn.com/picouterie.jpg" border="0" height="42" width="820"
           alt="You are using an outdated browser. For a faster, safer browsing experience, upgrade for free today or use other browser ,like chrome firefox safari."
           style='margin-left:auto;margin-right:auto;display: block;'/>
    </a>
  </div>
<![endif]-->
  



  <div class="container one-column 
   page-home 
">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><h1 class="site-meta">
  <span class="logo-line-before"><i></i></span>
  <a href="/" class="brand" rel="start">
      <span class="logo">
        <i class="icon-next-logo"></i>
      </span>
      <span class="site-title">ZhaoShanShan’s Blog</span>
  </a>
  <span class="logo-line-after"><i></i></span>
</h1>

<div class="site-nav-toggle">
  <button>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
  </button>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu ">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            <i class="menu-item-icon icon-next-home"></i> <br />
            Startseite
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories" rel="section">
            <i class="menu-item-icon icon-next-categories"></i> <br />
            Kategorien
          </a>
        </li>
      
        
        <li class="menu-item menu-item-about">
          <a href="/about" rel="section">
            <i class="menu-item-icon icon-next-about"></i> <br />
            Über
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives" rel="section">
            <i class="menu-item-icon icon-next-archives"></i> <br />
            Archiv
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags" rel="section">
            <i class="menu-item-icon icon-next-tags"></i> <br />
            Tags
          </a>
        </li>
      

      
      
    </ul>
  

  
</nav>

 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div id="content" class="content"> 
  <section id="posts" class="posts-expand">
    
      

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <header class="post-header">

      
      
        <h1 class="post-title" itemprop="name headline">
          
          
            
              <a class="post-title-link" href="/2015/10/29/解决软键盘和dialog一同消失的问题/" itemprop="url">
                解决软键盘和dialog一同消失的问题
              </a>
            
          
        </h1>
      

      <div class="post-meta">
        <span class="post-time">
          Veröffentlicht am
          <time itemprop="dateCreated" datetime="2015-10-29T16:18:45+08:00" content="2015-10-29">
            2015-10-29
          </time>
        </span>

        

        
          
            <span class="post-comments-count">
              &nbsp; | &nbsp;
              <a href="/2015/10/29/解决软键盘和dialog一同消失的问题/#comments" itemprop="discussionUrl">
                <span class="post-comments-count ds-thread-count" data-thread-key="2015/10/29/解决软键盘和dialog一同消失的问题/" itemprop="commentsCount"></span>
              </a>
            </span>
          
        
      </div>
    </header>

    <div class="post-body">

      
      

      
        
          <span itemprop="articleBody"><h3 id="前言">前言</h3><p>最近在做一个关于分享经验贴的一个App，其中文章详情界面出现了一个问题就是在界面的最下面有一条操作栏，其中有一项就是一个小的输入框,点击小的输入框，界面样式如下：</p>
<p><img src="https://github.com/zhanfangzxc/zhanfangzxc.github.io/blob/source/source/_posts/bottom.png?raw=true" alt="图一"></p>
<p>点击左侧的写评论的输入框，会出现如下界面:</p>
<p><img src="https://github.com/zhanfangzxc/zhanfangzxc.github.io/blob/source/source/_posts/open.png?raw=true" alt="图二"></p>
<p>这个界面是从底部弹出的一个Dialog，也可以用<a href="http://www.javabeat.net/dialog-activity-android/" target="_blank" rel="external">透明的Activity实现</a>,我这里使用的是github上的一个<a href="https://github.com/H07000223/FlycoDialog_Master" target="_blank" rel="external">开源的Dialog库</a>，因为动画设置，以及界面设置都比较方便，所以就用了这个，但是示例中没有我的这个应用场景，基本上就是一些条目点击选择的示例.</p>
<h3 id="问题描述">问题描述</h3><p>但是我们的项目中存在的问题就是当点击弹出Dialog的时候，要同时弹出软键盘，当点击返回键和或点击除Dialog的其他地方的时候，让Dialog和软件盘同时消失，就因为这个事搞了一天，最后还是借助别人的帮助实现的，但是还是想发出来供以后遇到该问题的朋友参考:</p>
<h3 id="解决方案">解决方案</h3><p>以下是解决方案，<strong>是通过计算弹出软键盘之前和之后的高度变化，来实现关闭Dialog的</strong>，在你创建的Dialog文件的<strong>OnCreateView()</strong>方法中添加如下代码:</p>
<pre><code><span class="comment">//监听视图树的布局变化</span>
view.getViewTreeObserver().addOnGlobalLayoutListener(<span class="keyword">new</span> ViewTreeObserver.OnGlobalLayoutListener() {
            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onGlobalLayout</span><span class="params">()</span> </span>{

                <span class="keyword">int</span>[] locations = <span class="keyword">new</span> <span class="keyword">int</span>[<span class="number">2</span>];

                <span class="comment">//计算该视图在全局坐标系中的x、y值，这个值是从屏幕顶端算起的，包括了通知栏的高度；得到的是当前屏幕内的绝对坐标</span>
                view.getLocationOnScreen(locations);
                <span class="keyword">int</span> y = locations[<span class="number">1</span>];
                <span class="keyword">if</span> (oldY != <span class="number">0</span> &amp;&amp; oldY &lt; y) {
                    <span class="comment">//从小变大 说明关闭了输入法</span>
                    Logger.d(<span class="string">"y的值是:"</span> + y + <span class="string">"oldY的值是:"</span> + oldY);
                    hide();
                }
                oldY = y;
            }
        });

        <span class="comment">//dialog的cancel事件的监听方法</span>

        setOnCancelListener(<span class="keyword">new</span> OnCancelListener() {
            @<span class="function">Override
            <span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onCancel</span><span class="params">(DialogInterface dialog)</span> </span>{
                imm.hideSoftInputFromWindow(mEtComment.getWindowToken(), <span class="number">0</span>);
            }
        });

        <span class="comment">//dialog的show事件的监听方法</span>

        setOnShowListener(<span class="keyword">new</span> OnShowListener() {
            @<span class="function">Override
            <span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onShow</span><span class="params">(DialogInterface dialog)</span> </span>{
                imm.toggleSoftInput(InputMethodManager.SHOW_FORCED, <span class="number">0</span>);
            }
        });
</code></pre><h3 id="总结">总结</h3><p>还有一点值得注意的就是在点击事件中<strong>showDialog</strong>的时候，一定要创建和show写在一起，如果将创建Dialog写在Activity中<strong>onCreate</strong>方法中，在点击事件中写<strong>show</strong>的话，就会存在，键盘第一次出现，可是当点击返回键让Dialog消失了之后，再点击让他显示的时候，就只会显示Dialog，不会显示软键盘，尽管我在Dialog的文件中写了show的监听事件，但是还是没什么效果，很是郁闷，希望找到解决方案的同学可以告知我。</p>
</span>
        
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <header class="post-header">

      
      
        <h1 class="post-title" itemprop="name headline">
          
          
            
              <a class="post-title-link" href="/2015/10/23/优秀文章整理/" itemprop="url">
                优秀文章整理
              </a>
            
          
        </h1>
      

      <div class="post-meta">
        <span class="post-time">
          Veröffentlicht am
          <time itemprop="dateCreated" datetime="2015-10-23T16:54:03+08:00" content="2015-10-23">
            2015-10-23
          </time>
        </span>

        

        
          
            <span class="post-comments-count">
              &nbsp; | &nbsp;
              <a href="/2015/10/23/优秀文章整理/#comments" itemprop="discussionUrl">
                <span class="post-comments-count ds-thread-count" data-thread-key="2015/10/23/优秀文章整理/" itemprop="commentsCount"></span>
              </a>
            </span>
          
        
      </div>
    </header>

    <div class="post-body">

      
      

      
        
          <span itemprop="articleBody"><h3 id="Handler相关">Handler相关</h3><p><strong>Handler消息机制</strong>:<a href="http://codecloud.net/android-handler-6351.html" target="_blank" rel="external">http://codecloud.net/android-handler-6351.html</a></p>
<h3 id="Handler消息机制简介">Handler消息机制简介</h3><ul>
<li>Handler 处理消息；发送消息，并将消息压入栈中</li>
<li>Lopper  通过loop()函数中的死循环，不断的从MessageQueue中取出Message，然后传给Handler进行处理。</li>
<li>MessageQueue 消息队列，用来存储Runnable、Message</li>
</ul>
<h3 id="为什么在主线程中能够直接创建Handler">为什么在主线程中能够直接创建Handler</h3><p>在ActivityThread.class的<strong>main()</strong>函数中，能够看到如下两句代码：</p>
<pre><code><span class="tag">Lopper</span><span class="class">.prepareMainLopper</span>();

<span class="tag">Lopper</span><span class="class">.loop</span>();
</code></pre><h3 id="在子线程创建Handler的步骤">在子线程创建Handler的步骤</h3><ol>
<li>Lopper.prepare();</li>
<li>实例化Handler，在构造方法中实现handleMessage(Message msg)处理消息;</li>
<li>Lopper.loop();</li>
</ol>
<p>第一步源码：</p>
<pre><code><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Lopper</span></span>{
    ...
    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> ThreadLocal sThreadLocal = <span class="keyword">new</span> ThreadLocal();

    <span class="keyword">final</span> MessageQueue mQueue;

    ......

    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">void</span> <span class="title">prepare</span><span class="params">()</span></span>{
        <span class="keyword">if</span>(sThreadLocal.get() != <span class="keyword">null</span>){
            <span class="keyword">throw</span> <span class="keyword">new</span> RuntimeException(<span class="string">"Only one Lopper may be created per thread"</span>);
        }
        <span class="comment">//创建一个Looper对象，并绑定到ThreadLocal中</span>
        <span class="comment">//为了保证每一个调用prepare()函数的线程里面都有一个唯一的Looper对象</span>
        <span class="comment">//在创建Looper的同时也创建了一个MessageQueue对象</span>
        sThreadLocal.set(<span class="keyword">new</span> Lopper());
    }

    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">void</span> <span class="title">prepareMainLopper</span><span class="params">()</span></span>{
        prepare();
        setMainLooper(myLooper());
        <span class="keyword">if</span>(Process.supportProcesses()){
            myLooper().mQueue.mQuitAllowed = <span class="keyword">false</span>;
        }
    }

    <span class="function"><span class="keyword">private</span> <span class="keyword">synchronized</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">setMainLooper</span><span class="params">(Looper looper)</span></span>{
        sMainLooper = Looper;
    }

    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> Looper <span class="title">myLooper</span><span class="params">()</span></span>{
        <span class="keyword">return</span> (Looper)sThreadLocal.get();
    }

    <span class="function"><span class="keyword">private</span> <span class="title">Looper</span><span class="params">()</span></span>{
        mQueue = <span class="keyword">new</span> MessageQueue();
        mRun = <span class="keyword">true</span>;
        mThread = Thread.currentThread();
    }
}
</code></pre><p>第二步：创建Handler实例</p>
<pre><code>Handler <span class="keyword">handler</span> = <span class="keyword">new</span> Handler(){
    <span class="keyword">public</span> <span class="function"><span class="keyword">void</span> <span class="title">handleMessage</span><span class="params">(Message msg)</span></span>{
        <span class="comment">//处理消息逻辑</span>
    }
};

<span class="comment">//Handler的构造函数</span>
<span class="function"><span class="keyword">public</span> <span class="title">Handler</span><span class="params">()</span></span>;
<span class="function"><span class="keyword">public</span> <span class="title">Handler</span><span class="params">(Callback callback)</span></span>;
<span class="function"><span class="keyword">public</span> <span class="title">Handler</span><span class="params">(Looper looper)</span></span>;
<span class="function"><span class="keyword">public</span> <span class="title">Handler</span><span class="params">(Looper looper,Callback callback)</span></span>;

<span class="comment">//源码</span>

<span class="function"><span class="keyword">public</span> <span class="title">Handler</span><span class="params">(Callback callback,<span class="keyword">boolean</span> async)</span></span>{
    mLooper = Looper.myLooper();
    <span class="keyword">if</span>(myLooper == <span class="keyword">null</span>){
        <span class="keyword">throw</span> <span class="keyword">new</span> RuntimeException(<span class="string">"XXX"</span>);
    }
    mQueue = mLooper.mQueue;
    mCallback = callback;
    mAsynchronous = async;
}
</code></pre><blockquote>
<p>在创建Handler之前必须先有一个Looper，在创建Looper的同时会创建一个MessageQueue对象，所以在Handler的构造函数中能够同时获取Looper和MessageQueue这两个对象。</p>
</blockquote>
<p>第三步Lopper.loop()的源码：</p>
<pre><code><span class="keyword">public</span> <span class="keyword">static</span> <span class="function"><span class="keyword">void</span> <span class="title">loop</span><span class="params">()</span></span>{
    <span class="keyword">final</span> Looper me = myLooper();
    <span class="keyword">final</span> MessageQueue queue = me.mQueue;

    <span class="keyword">for</span>(;;){
        Message msg = queue.next();
        <span class="keyword">if</span>(msg == <span class="keyword">null</span>){
            <span class="keyword">return</span>;
        }
        ...
        <span class="comment">//关键代码</span>
        msg.<span class="keyword">target</span>.dispatchMessage(msg);
    }
}
</code></pre><p>接下来看<strong>dispatch(msg)</strong>方法的源码</p>
<pre><code><span class="keyword">public</span> <span class="function"><span class="keyword">void</span> <span class="title">dispatchMessage</span><span class="params">(Message msg)</span></span>{
    <span class="keyword">if</span>(msg.callback != <span class="keyword">null</span>){
        handleCallback(msg);
    }<span class="keyword">else</span>{
        <span class="keyword">if</span>(mCallback != <span class="keyword">null</span>){
            <span class="keyword">if</span>(mCallback.handleMessage(msg)){
                <span class="keyword">return</span>;
            }
        }
        <span class="comment">//这个即是我们每次创建Handler的时候需要实现的方法</span>
        handleMessage(msg);
    }
}
</code></pre><h3 id="发送消息">发送消息</h3><blockquote>
<p>我们一般发送消息通过sendMessage(msg),下面是发送消息的源码：</p>
</blockquote>
<pre><code><span class="keyword">public</span> <span class="function"><span class="keyword">boolean</span> <span class="title">sendMessageAtTime</span><span class="params">(Message msg,<span class="keyword">long</span> uptimeMillis)</span></span>{
    MessageQueue queue = mQueue;
    <span class="keyword">if</span>(queue == <span class="keyword">null</span>){
        RuntimeException e = <span class="keyword">new</span> RuntimeException(<span class="string">"XXX"</span>);
        <span class="keyword">return</span> <span class="keyword">false</span>;
    }
    <span class="comment">//将Message压入MessageQueue中</span>
    <span class="function"><span class="keyword">return</span> <span class="title">enqueueMessage</span><span class="params">(queue,mag,uptimeMillis)</span></span>;
}
</code></pre></span>
        
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <header class="post-header">

      
      
        <h1 class="post-title" itemprop="name headline">
          
          
            
              <a class="post-title-link" href="/2015/10/12/Retrofit2-更新指南/" itemprop="url">
                Retrofit2 更新指南
              </a>
            
          
        </h1>
      

      <div class="post-meta">
        <span class="post-time">
          Veröffentlicht am
          <time itemprop="dateCreated" datetime="2015-10-12T09:39:49+08:00" content="2015-10-12">
            2015-10-12
          </time>
        </span>

        
          <span class="post-category" >
            &nbsp; | &nbsp; in
            
              <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                <a href="/categories/Android/" itemprop="url" rel="index">
                  <span itemprop="name">Android</span>
                </a>
              </span>

              
              

            
          </span>
        

        
          
            <span class="post-comments-count">
              &nbsp; | &nbsp;
              <a href="/2015/10/12/Retrofit2-更新指南/#comments" itemprop="discussionUrl">
                <span class="post-comments-count ds-thread-count" data-thread-key="2015/10/12/Retrofit2-更新指南/" itemprop="commentsCount"></span>
              </a>
            </span>
          
        
      </div>
    </header>

    <div class="post-body">

      
      

      
        
          <span itemprop="articleBody"><p>原文链接:<a href="https://futurestud.io/blog/retrofit-2-upgrade-guide-from-1-9/" target="_blank" rel="external">https://futurestud.io/blog/retrofit-2-upgrade-guide-from-1-9/</a></p>
<h3 id="Retrofit概述">Retrofit概述</h3><ol>
<li><a href="https://futurestud.io/blog/retrofit-getting-started-and-android-client/" target="_blank" rel="external">Getting Started and Create an Android Client</a></li>
<li><a href="https://futurestud.io/blog/android-basic-authentication-with-retrofit/" target="_blank" rel="external">Basic Authentication with Retrofit</a></li>
<li><a href="https://futurestud.io/blog/oauth-2-on-android-with-retrofit/" target="_blank" rel="external">OAuth with Retrofit</a></li>
<li><a href="https://futurestud.io/blog/retrofit-token-authentication-on-android/" target="_blank" rel="external">Token Authentication with Retrofit</a></li>
<li><a href="https://futurestud.io/blog/retrofit-synchronous-and-asynchronous-requests/" target="_blank" rel="external">Synchronous and Aynchronous Request Execution with Retrofit</a></li>
<li><a href="https://futurestud.io/blog/retrofit-multiple-query-parameters-of-same-name/" target="_blank" rel="external">Multiple Query Parameters of Same Name</a></li>
<li><a href="https://futurestud.io/blog/retrofit-send-objects-in-request-body/" target="_blank" rel="external">Send Objects in Request Body with Retrofit</a></li>
<li><a href="https://futurestud.io/blog/retrofit-replace-the-integrated-json-converter/" target="_blank" rel="external">Define Custom JSON Converter</a></li>
<li><a href="https://futurestud.io/blog/retrofit-add-custom-request-header/" target="_blank" rel="external">Add Custom HTTP Request Headers</a></li>
<li><a href="https://futurestud.io/blog/retrofit-add-custom-request-header/" target="_blank" rel="external">Optional Query Parameters</a></li>
<li><a href="https://futurestud.io/blog/retrofit-how-to-integrate-xml-converter/" target="_blank" rel="external">XML Converter with Retrofit</a></li>
<li><a href="https://futurestud.io/blog/retrofit-using-the-log-level-to-debug-requests/" target="_blank" rel="external">Debugging Requests with Retrofit’s Log Level</a></li>
<li><a href="https://futurestud.io/blog/retrofit-how-to-upload-files/" target="_blank" rel="external">File Upload with Retrofit</a></li>
<li><a href="https://futurestud.io/blog/retrofit-series-round-up/" target="_blank" rel="external">Round-Up Retrofit Series</a></li>
<li><a href="https://futurestud.io/blog/retrofit-2-upgrade-guide-from-1-9/" target="_blank" rel="external">Retrofit Upgrade Guide: 1.9 to 2.0</a></li>
</ol>
<h3 id="添加Gradle依赖项">添加Gradle依赖项</h3><pre><code><span class="keyword">compile</span> <span class="string">'com.squareup.retrofit:retrofit:2.0.0-beta2'</span>
<span class="keyword">compile</span> <span class="string">'com.square.okhttp:okhttp:2.5.0'</span>
</code></pre><p>Retrofit 2默认情况下不集成Gson，在之前，你不用去考虑转换器的集成问题，现在的变化需要你导入你需要的转换器开源库，接下来将会给你展示如何配置Gson或其他的转换器。</p>
<h3 id="转换器">转换器</h3><pre><code><span class="title">comile</span> <span class="string">'com.squareup.retrofit:converter-gson:2.0.0-beta2'</span>
</code></pre><p>默认情况戏Rxjava也不会引入，所以你需要手动的添加Rxjava的依赖项</p>
<pre><code><span class="keyword">compile</span> <span class="string">'com.squareup.retrofit:adapter-rxjava:2.0.0-beta2'</span>
<span class="keyword">compile</span> <span class="string">'io.reativex:rxandroid:1.0.1'</span>
</code></pre><h3 id="RestAdapter_-&gt;_Retrofit">RestAdapter -&gt; Retrofit</h3><p>之前的<strong>RestAdapter</strong>重新命名为<strong>Retrofit</strong></p>
<p><strong>Retrofit 1.9</strong></p>
<pre><code>RestAdapter.Builder builder = <span class="keyword">new</span> RestAdapter.Builder();
</code></pre><p><strong>Retrofit 2.0</strong></p>
<pre><code>Retrofit.Builder builder = <span class="keyword">new</span> Retrofit.Builder();
</code></pre><h3 id="setEndPoint_-&gt;_baseUrl">setEndPoint -&gt; baseUrl</h3><p><strong>setEndPoint</strong>方法变成了<strong>baseUrl</strong></p>
<p><strong>Retrofit 1.9</strong></p>
<pre><code><span class="label">RestAdapter.Builder</span> <span class="keyword">builder </span>= new RestAdapter.<span class="keyword">Builder()
</span>    .<span class="keyword">setEndpoint(API_BASE_URL)
</span>    .<span class="keyword">build();
</span>
<span class="label">YourService</span> service = adapter.create(YourService.class)<span class="comment">;</span>
</code></pre><p><strong>Retrofit 2.0</strong></p>
<pre><code><span class="label">Retrofit.Builder</span> <span class="keyword">builder </span>= new Retrofit.<span class="keyword">Builder()
</span>    .<span class="keyword">baseUrl(API_BASE_URL)
</span>    .<span class="keyword">build();
</span>
<span class="label">YourService</span> service = retrofit.create(YourService.class)<span class="comment">;</span>
</code></pre><h3 id="Base_Url_处理">Base Url 处理</h3><p>在之前的版本，定义的endpoint会作为默认的请求url，你自己定义的那部分包括查询或路径参数，请求体或multiparts，所以最后的请求url是endpoint url和自己定义的那部分url的结合：</p>
<p><strong>Retrofit 1.x</strong></p>
<pre><code><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">UserService</span>{</span>
    <span class="annotation">@POST</span>(<span class="string">"me"</span>)
    User me();
}

RestAdapter adapter = RestAdapter.Builder()
    .baseUrl(<span class="string">"http://your.api.url/v2/"</span>);
    .build();

UserService service = adapter.create(UserService.<span class="keyword">class</span>);

<span class="comment">//所以对于service.me()方法的请求url就是：</span>
<span class="comment">//Https://your.api.url/v2/me</span>
</code></pre><p><strong>Retrofit 2.x</strong></p>
<pre><code><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">UserService</span>(){</span>
    <span class="annotation">@POST</span>(<span class="string">"/me"</span>)
    User me();
}

Retrofit retrofit = Retrofit.Builder()
    .baseUrl(<span class="string">"https://your.api.url/v2"</span>);
    .build();

UserService service = retrofit.create(UserService.<span class="keyword">class</span>);

<span class="comment">// 最终service.me()方法的请求url是：</span>
<span class="comment">// http://your.api.url/me</span>
</code></pre><p>第二种样子</p>
<pre><code><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">UserService</span> </span>{  
    <span class="annotation">@POST</span>(<span class="string">"me"</span>)
    <span class="function">User <span class="title">me</span><span class="params">()</span></span>;
}

Retrofit retrofit = Retrofit.Builder()  
    .baseUrl(<span class="string">"https://your.api.url/v2/"</span>);
    .build();

UserService service = retrofit.create(UserService.cass);

<span class="comment">// the request url for service.me() is: </span>
<span class="comment">// https://your.api.url/v2/me</span>
</code></pre><h3 id="动态Url">动态Url</h3><pre><code><span class="tag">public</span> <span class="tag">interface</span> <span class="tag">UserService</span>{
    <span class="variable">@GET</span>
    public Call&lt;File&gt; <span class="function">getZipFile</span>(<span class="variable">@Url</span> String url);
}
</code></pre><h3 id="OkHttp请求">OkHttp请求</h3><pre><code><span class="keyword">compile</span> <span class="string">'com.squareup.okhttp:okhttp:2.5.0'</span>
</code></pre><h3 id="OkHttp拦截器">OkHttp拦截器</h3><pre><code><span class="type">OkHttpClient</span> client = new <span class="type">OkHttpClient</span>();  
client.interceptors().add(new <span class="type">Interceptor</span>() {  
    @<span class="type">Override</span>
    public <span class="type">Response</span> intercept(<span class="type">Chain</span> chain) throws <span class="type">IOException</span> {
        <span class="type">Request</span> original = chain.request();

        // <span class="type">Customize</span> the request 
        <span class="type">Request</span> request = original.newBuilder()
                .header(<span class="string">"Accept"</span>, <span class="string">"application/json"</span>)
                .header(<span class="string">"Authorization"</span>, <span class="string">"auth-token"</span>)
                .<span class="keyword">method</span>(original.<span class="keyword">method</span>(), original.body())
                .build();

        <span class="type">Response</span> response = chain.proceed(request);

        // <span class="type">Customize</span> <span class="keyword">or</span> <span class="keyword">return</span> the response 
        <span class="keyword">return</span> response;
    }
});

<span class="type">Retrofit</span> retrofit = <span class="type">Retrofit</span>.<span class="type">Builder</span>()  
    .baseUrl(<span class="string">"https://your.api.url/v2/"</span>);
    .client(client)
    .build();
</code></pre><p>如果你要使用自定义的OkHttpClient，你必须要设置在<strong>Retrofit.Builder</strong>中设置Client通过<strong>.client()</strong>方法，这将会更新默认的Client。</p>
<h3 id="同步和异步请求">同步和异步请求</h3><p>同步方法需要一个返回类型，异步方法需要一个Callback作为最后一个参数</p>
<p>在Retrofit 2中，同步和异步将没有什么区别，请求现在包裹成一个通用的类使用所需的响应类型。下面的内容将为你讲述Retrofit 1和Retrofit 2在service声明和请求执行方面的区别。</p>
<h3 id="Interface_声明">Interface 声明</h3><p>同步和异步请求的区别，你定义任何实际类型或者<strong>Void</strong>作为返回类型，异步需要你定义一个通用的回调作为最后一个方法参数，，下面的代码展示了一个Retrofit 1的声明方法：</p>
<p><strong>Retrofit 1.9</strong></p>
<pre><code><span class="tag">public</span> <span class="tag">interface</span> <span class="tag">UserService</span> {  
    <span class="comment">// Synchronous Request</span>
    <span class="variable">@POST</span>(<span class="string">"/login"</span>)
    User <span class="function">login</span>();

    <span class="comment">// Asynchronous Request</span>
    <span class="variable">@POST</span>(<span class="string">"/login"</span>)
    void <span class="function">getUser</span>(<span class="variable">@Query</span> String id, Callback&lt;User&gt; cb);
}
</code></pre><p><strong>Retrofit 2.x</strong></p>
<pre><code><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">UserService</span> </span>{  
    <span class="annotation">@POST</span>(<span class="string">"/login"</span>)
    <span class="function">Call&lt;User&gt; <span class="title">login</span><span class="params">()</span></span>;
}
</code></pre><h3 id="请求执行">请求执行</h3><p><strong>Retrofit 1.9</strong></p>
<pre><code><span class="comment">// synchronous</span>
User user = userService.login();

<span class="comment">// asynchronous</span>
userService.login(<span class="keyword">new</span> Callback&lt;User&gt;() {  
<span class="annotation">@Override</span>
    <span class="keyword">public</span> <span class="function"><span class="keyword">void</span> <span class="title">success</span><span class="params">(User user, Response response)</span> </span>{
        <span class="comment">// handle response</span>
    }

    <span class="annotation">@Override</span>
    <span class="keyword">public</span> <span class="function"><span class="keyword">void</span> <span class="title">failure</span><span class="params">(RetrofitError <span class="keyword">error</span>)</span> </span>{
        <span class="comment">// handle error</span>
    }
});
</code></pre><p>Retrofit 1和Retrofit 2的请求完全不同，在2中所有的请求都会包裹在一个<strong>Call</strong>对象中，你可以通过<strong>call.execute()</strong>执行同步请求，通过<strong>call.enqueue(new Callback&lt;&gt;())</strong>来执行异步请求，下面是示例代码：</p>
<pre><code><span class="comment">// synchronous</span>
<span class="keyword">Call</span>&lt;User&gt; <span class="keyword">call</span> = userService.login();  
User user = <span class="keyword">call</span>.execute();

<span class="comment">// asynchronous</span>
<span class="keyword">Call</span>&lt;User&gt; <span class="keyword">call</span> = userService.login();  
<span class="keyword">call</span>.enqueue(<span class="keyword">new</span> Callback&lt;User&gt;() {  
    @Override
    <span class="keyword">public</span> <span class="keyword">void</span> onResponse(Response&lt;User&gt; response, Retrofit retrofit) {
        <span class="comment">// response.isSuccess() is true if the response code is 2xx</span>
        <span class="keyword">if</span> (response.isSuccess()) {
            User user = response.body();
        } <span class="keyword">else</span> {
            <span class="keyword">int</span> statusCode = response.code();

            <span class="comment">// handle request errors yourself</span>
            ResponseBody errorBody = response.errorBody();
        }
    }

    @Override
    <span class="keyword">public</span> <span class="keyword">void</span> onFailure(Throwable t) {
        <span class="comment">// handle execution failures like no internet connectivity </span>
    }
}
</code></pre><p>在Retrofit 2中即使请求不成功也会调用<strong>onResponse()</strong>.<strong>Response</strong>类有一个<strong>isSuccess()</strong>方法用来检查是否处理成功(返回<strong>2xx</strong>的状态码)，你可以利用响应对象来做进一步的处理，如果状态码不是2xx，你需要自行处理错误，如果你希望在失败的情况下得到一个响应体，那么你就需要通过<strong>ResponseBody</strong>类中的<strong>errorBody()</strong>方法来转换对象。</p>
<blockquote>
<p>同步请求在Android上可能会导致应用程序崩溃在Android 4.0 +。使用异步请求来避免阻塞会导致应用程序的主UI线程失败。</p>
</blockquote>
<h3 id="取消请求">取消请求</h3><p>在Retrofit 1中没有提供取消请求的方法，在Retrofit 2中如果http调度程序没有执行他的时候，你可以取消任何请求。</p>
<pre><code><span class="operator"><span class="keyword">Call</span>&lt;<span class="keyword">User</span>&gt; <span class="keyword">call</span> = userService.login();</span>
User user = <span class="operator"><span class="keyword">call</span>.<span class="keyword">execute</span>();</span>

<span class="operator"><span class="keyword">call</span>.<span class="keyword">cancel</span>();</span>
</code></pre><h3 id="没有默认的转换器">没有默认的转换器</h3><p>在之前的1的版本中默认有Gson做为json的转换器，在2的版本中没有默认的转换器，你需要自己定义转换器，如果你想使用Gson，就必须要在gradle添加Gson的依赖项：</p>
<pre><code><span class="keyword">compile</span> <span class="string">'com.squareup.retrofit:converter-gson:2.0.0-beta2'</span>  
</code></pre><p><strong>可用的转换器</strong></p>
<ul>
<li>GSON: com.squareup.retrofit:converter-gson:2.0.0-beta2</li>
<li>Moshi: com.squareup.retrofit:converter-moshi:2.0.0-beta2</li>
<li>Jackson: com.squareup.retrofit:converter-jackson:2.0.0-beta2</li>
<li>SimpleXML: com.squareup.retrofit:converter-simplexml:2.0.0-beta2</li>
<li>ProtoBuf: com.squareup.retrofit:converter-protobuf:2.0.0-beta2</li>
<li>Wire: com.squareup.retrofit:converter-wire:2.0.0-beta2</li>
</ul>
<h3 id="给Retrofit添加转换器">给Retrofit添加转换器</h3><pre><code><span class="type">Retrofit</span> retrofit = <span class="type">Retrofit</span>.<span class="type">Builder</span><span class="literal">()</span>  
    .baseUrl(<span class="string">"https://your.api.url/v2/"</span>);
    .addConverterFactory(<span class="type">ProtoConverterFactory</span>.create<span class="literal">()</span>)
    .addConverterFactory(<span class="type">GsonConverterFactory</span>.create<span class="literal">()</span>)
    .build<span class="literal">()</span>;
</code></pre><h3 id="Rxjava_集成">Rxjava 集成</h3><p>Retrofit 1中集成了三中请求执行机制：同步，异步和Rxjava；在Retrofit 2中默认的只有同步和异步的请求，但是Retrofit提供了一个添加其他请求执行机制进Retrofit中的方法，你可以添加更多的机制在你的app中，比如说Rxjava</p>
<p><strong>Gradle 依赖</strong></p>
<pre><code><span class="keyword">compile</span> <span class="string">'com.squareup.retrofit:adapter-rxjava:2.0.0-beta2'</span>  
<span class="keyword">compile</span> <span class="string">'io.reactivex:rxandroid:1.0.1'</span>  
</code></pre><p>接下来需要在创建service实例之前添加一个<strong>CallAdapter</strong>进<strong>Retrofit</strong>对象</p>
<pre><code><span class="label">Retrofit</span> retrofit = new Retrofit.<span class="keyword">Builder() </span> 
    .<span class="keyword">baseUrl(baseUrl);
</span>    .<span class="keyword">addCallAdapterFactory(RxJavaCallAdapterFactory.create())
</span>    .<span class="keyword">addConverterFactory(GsonConverterFactory.create())
</span>    .<span class="keyword">build();</span>
</code></pre><p>具体代码：</p>
<pre><code><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">UserService</span> </span>{  
    <span class="annotation">@POST</span>(<span class="string">"/me"</span>)
    <span class="function">Observable&lt;User&gt; <span class="title">me</span><span class="params">()</span></span>;
}

<span class="comment">// this code is part of your activity/fragment</span>
Observable&lt;User&gt; observable = userService.me();  
observable.observeOn(AndroidSchedulers.mainThread()).subscribe(<span class="keyword">new</span> Subscriber&lt;User&gt;() {  
    <span class="annotation">@Override</span>
    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onCompleted</span><span class="params">()</span> </span>{
        <span class="comment">// handle completed</span>
    }

    <span class="annotation">@Override</span>
    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onError</span><span class="params">(Throwable e)</span> </span>{
        <span class="comment">// handle error</span>
    }

    <span class="annotation">@Override</span>
    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onNext</span><span class="params">(User user)</span> </span>{
        <span class="comment">// handle response</span>
    }
});
</code></pre><h3 id="附加资源">附加资源</h3><ul>
<li><a href="https://www.youtube.com/watch?v=KIAoQbAu3eA" target="_blank" rel="external">Jake Wharton’s talk @ Droidcon NYC 2015 on Retrofit 2</a></li>
<li><a href="https://github.com/square/okhttp/wiki/Interceptors" target="_blank" rel="external">Details on OkHttp interceptors</a></li>
<li><a href="https://github.com/square/retrofit/tree/master/retrofit-converters" target="_blank" rel="external">Retrofit Converters</a></li>
<li><a href="https://github.com/ReactiveX/RxAndroid" target="_blank" rel="external">RxAndroid on GitHub</a></li>
<li><a href="https://github.com/square/retrofit/tree/master/retrofit-adapters" target="_blank" rel="external">Retrofit CallAdapters</a></li>
<li><a href="https://github.com/square/retrofit/blob/master/CHANGELOG.md" target="_blank" rel="external">Retrofit Change Log</a></li>
</ul>
</span>
        
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <header class="post-header">

      
      
        <h1 class="post-title" itemprop="name headline">
          
          
            
              <a class="post-title-link" href="/2015/10/09/Android基础整理/" itemprop="url">
                Android基础整理
              </a>
            
          
        </h1>
      

      <div class="post-meta">
        <span class="post-time">
          Veröffentlicht am
          <time itemprop="dateCreated" datetime="2015-10-09T12:12:33+08:00" content="2015-10-09">
            2015-10-09
          </time>
        </span>

        
          <span class="post-category" >
            &nbsp; | &nbsp; in
            
              <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                <a href="/categories/Android/" itemprop="url" rel="index">
                  <span itemprop="name">Android</span>
                </a>
              </span>

              
              

            
          </span>
        

        
          
            <span class="post-comments-count">
              &nbsp; | &nbsp;
              <a href="/2015/10/09/Android基础整理/#comments" itemprop="discussionUrl">
                <span class="post-comments-count ds-thread-count" data-thread-key="2015/10/09/Android基础整理/" itemprop="commentsCount"></span>
              </a>
            </span>
          
        
      </div>
    </header>

    <div class="post-body">

      
      

      
        
          <span itemprop="articleBody"><h3 id="Intent">Intent</h3><p>####<br>用来启动Activity:</p>
<pre><code><span class="function">startActivity</span>();

<span class="comment">//带返回结果</span>
<span class="function">startActivityForResult</span>();

<span class="comment">//获取返回结果的方法</span>
<span class="function">onActivityResult</span>();
</code></pre><p>用来启动Service:</p>
<pre><code><span class="comment">//启动服务</span>
<span class="function">startService</span>();

<span class="comment">//绑定服务</span>
<span class="function">bindService</span>();
</code></pre><p>传递广播:</p>
<pre><code>sendBroadcast()<span class="comment">;</span>

sendOrderedBroadcast()<span class="comment">;</span>

sendStickyBroadcast()<span class="comment">;</span>
</code></pre></span>
        
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <header class="post-header">

      
      
        <h1 class="post-title" itemprop="name headline">
          
          
            
              <a class="post-title-link" href="/2015/10/08/代码片段/" itemprop="url">
                代码片段
              </a>
            
          
        </h1>
      

      <div class="post-meta">
        <span class="post-time">
          Veröffentlicht am
          <time itemprop="dateCreated" datetime="2015-10-08T13:47:59+08:00" content="2015-10-08">
            2015-10-08
          </time>
        </span>

        
          <span class="post-category" >
            &nbsp; | &nbsp; in
            
              <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                <a href="/categories/Android/" itemprop="url" rel="index">
                  <span itemprop="name">Android</span>
                </a>
              </span>

              
              

            
          </span>
        

        
          
            <span class="post-comments-count">
              &nbsp; | &nbsp;
              <a href="/2015/10/08/代码片段/#comments" itemprop="discussionUrl">
                <span class="post-comments-count ds-thread-count" data-thread-key="2015/10/08/代码片段/" itemprop="commentsCount"></span>
              </a>
            </span>
          
        
      </div>
    </header>

    <div class="post-body">

      
      

      
        
          <span itemprop="articleBody"><h3 id="手机号中自动添加”-“">手机号中自动添加”-“</h3><p>为Edittext添加监听方法</p>
<pre><code>edittext.addTextChangedListener(<span class="keyword">new</span> TextWatcher());
</code></pre><p>TextWatcher接口如下:</p>
<pre><code><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">TextWatcher</span> <span class="keyword">extends</span> <span class="title">NoCopySpan</span></span>{

    <span class="comment">//在字符串s被，从索引start(包含)的字符开始的count个字符，将被长度为after的新文本代替。</span>
    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">beforeTextChanged</span><span class="params">(CharSequence s,<span class="keyword">int</span> start,<span class="keyword">int</span> count, <span class="keyword">int</span> after)</span></span>;

    <span class="comment">//在字符串s内，从索引start(包含)的字符开始count个字符刚刚替换了长度为before的旧字符。</span>
    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onTextChanged</span><span class="params">(CharSequence s, <span class="keyword">int</span> start, <span class="keyword">int</span> before, <span class="keyword">int</span> count)</span></span>;

    <span class="comment">//字符串s内容已经发生了变化</span>
    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">afterTextChanged</span><span class="params">(Editable s)</span></span>;
}
</code></pre><p>具体操作:</p>
<pre><code><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onTextChanged</span><span class="params">(CharSequence s,<span class="keyword">int</span> start,<span class="keyword">int</span> before, <span class="keyword">int</span> count)</span></span>{
    <span class="keyword">if</span>(count == <span class="number">1</span>){
        <span class="keyword">int</span> length = s.toString().length();
        <span class="keyword">if</span>(length == <span class="number">3</span> || length == <span class="number">8</span>){
            editText.setText(s + <span class="string">"-"</span>);
            editText.setSelection(editText.getText().toString().length());
        }
    }
}
</code></pre><h3 id="Handler的优化">Handler的优化</h3><p>在Android应用启动时，framework会为该应用程序的主线程创建一个Lopper对象，这个Lopper对象包含一个简单的消息队列，并且能够循环处理队列中的消息。主线程的Lopper对象会被碎该应用程序的整个生命周期。</p>
<p>造成内存泄漏的原因：只要有未处理的消息，那么该消息就会引用Handler，非静态的Handler又会引用外部类，即Activity，导致Activity无法被回收，造成泄漏。</p>
<p><strong>静态内部类不会持有对外部类的引用</strong></p>
<p>解决方案：</p>
<pre><code>public <span class="class"><span class="keyword">class</span> <span class="title">SampleActivity</span> <span class="keyword"><span class="keyword">extends</span></span> <span class="title">Activity</span>{</span>

    <span class="keyword">private</span> static <span class="class"><span class="keyword">class</span> <span class="title">MyHandler</span> <span class="keyword"><span class="keyword">extends</span></span> <span class="title">Handler</span>{</span>
        <span class="keyword">private</span> <span class="keyword">final</span> <span class="type">WeakReference</span>&lt;<span class="type">SampleActivity</span>&gt; mActivity;

        public <span class="type">MyHandler</span>(<span class="type">SampleActivity</span> activity){
            mActivity = <span class="keyword">new</span> <span class="type">WeakReference</span>&lt;<span class="type">SampleActivity</span>&gt;(activity);
        }

        <span class="annotation">@Override</span>
        public void handleMessage(<span class="type">Message</span> msg){
            <span class="type">SampleActivity</span> activity = mActivity.get();
            <span class="keyword">if</span>(activity != <span class="literal">null</span>){
                <span class="comment">//...</span>
            }
        }
    }

    <span class="keyword">private</span> <span class="keyword">final</span> <span class="type">MyHandler</span> mHandler = <span class="keyword">new</span> <span class="type">MyHandler</span>(<span class="keyword">this</span>);

    <span class="keyword">private</span> static <span class="keyword">final</span> <span class="type">Runnable</span> sRunnable = <span class="keyword">new</span> <span class="type">Runnable</span>(){
        <span class="annotation">@Override</span>
        public void run(){

        }
    }

    <span class="annotation">@Override</span>
    <span class="keyword">protected</span> void onCreate(<span class="type">Bundle</span> savedInstanceState){
        <span class="keyword">super</span>.onCreate(savedInstanceState);

        mHandler.postDelayed(sRunnable,<span class="number">1000</span>*<span class="number">60</span>*<span class="number">10</span>);

        finish();
    }
}
</code></pre><h3 id="实现对隐式Intent的运行时检查">实现对隐式Intent的运行时检查</h3><p>如果想打开相机或者发送图片等隐式Intent，比如说打开相机， 如果手机中不存在相机的话，那么系统就会抛出<strong>ActivityNotFoundException</strong>,如果不做处理的话，程序就会崩溃。所以具体的解决方案是，在使用隐式Intent的时候，首先进行检查，代码如下：</p>
<pre><code><span class="type">Intent</span> <span class="type">intent</span> = new <span class="type">Intent</span>(<span class="type">Intent</span>.Action_XXX);
ComponentName componentName = <span class="type">intent</span>.resolveActivity(getPacakgeManager());
<span class="keyword">if</span>(componentName <span class="comment">!= null){</span>
    String className = component.getClassName();
}
</code></pre><h3 id="使用NotificationCompat兼容包来处理消息通知">使用NotificationCompat兼容包来处理消息通知</h3><pre><code>NotificationCompat.Builder builder = <span class="keyword">new</span> NotificationCompat.Builder(<span class="keyword">this</span>);
builder.setSmallIcon(R.drawable.notification_icon);
<span class="keyword">String</span> <span class="built_in">text</span> = <span class="string">"aaaaa"</span>;
builder.setContentText(<span class="built_in">text</span>);

<span class="comment">//添加点击效果</span>
PendingIntent intent = XXX;
builder.setContentIntent(intent);

<span class="built_in">int</span> <span class="built_in">color</span> = getResources().getColor(R.<span class="built_in">color</span>.black);
builder.setColor(<span class="built_in">color</span>);

<span class="comment">//设置图片</span>
Bitmap bitmap = ...;
builder.setLargeIcon(bitmap);

<span class="comment">//设置样式</span>
builder.setStyle(<span class="keyword">new</span> NotificationCompat.bigTextStyle(<span class="built_in">text</span>));

PendingIntent intent =...;
builder.addAction(mew NotificationCompat.Action(R.drawable.icon,<span class="string">"Mute"</span>,intent));

<span class="comment">//设置穿戴设备的样式</span>
NotificationCompat.WearableExtender wearableExtender = <span class="keyword">new</span> NotificationCompat.WearableExtender();
RemoteInput remoteInput = <span class="keyword">new</span> RemoteInput.Builder(<span class="string">"voice_result_key"</span>).setLabel(<span class="string">"Reply"</span>).build();

wearableExtender.addAction(<span class="keyword">new</span> NotificationCompat.Action.Builder(R.drawable.mute_icon,<span class="string">"Reply"</span>,replyIntent).addRemoteInout(remoteInput).build);
builder.extend(wearableExtender);

Notification notification = builder.build();
NotificationManagerCompat.from(<span class="keyword">this</span>).notify(<span class="number">0</span>,notification);
</code></pre><h3 id="使用Toobar代替ActionBar">使用Toobar代替ActionBar</h3><p>第一步：改变主题为<strong>Theme.AppCompat.NoActionBar</strong></p>
<p>第二步：修改布局文件</p>
<pre><code>&lt;android<span class="class">.support</span><span class="class">.v7</span><span class="class">.widget</span><span class="class">.Toolbar</span>
    android:id=<span class="string">"@+id/id_toolbar"</span>
    android:layout_width=<span class="string">"match_parent"</span>
    android:layout_height＝<span class="string">"wrap_content"</span>
    android:layout_alignParentTop=<span class="string">"true"</span>
    android:minHeight=<span class="string">"?attr.actionBarSize"</span>&gt;
&lt;/android<span class="class">.support</span><span class="class">.v7</span><span class="class">.widget</span><span class="class">.Toolbar</span>&gt;
</code></pre><p>第三步：修改代码</p>
<pre><code><span class="annotation">@Override</span>
<span class="keyword">protected</span> <span class="function"><span class="keyword">void</span> <span class="title">onCreate</span><span class="params">(Bundle savedInstanceState)</span></span>{
    setContentView(R.layout.activity_main);
    Toolbar toolbar = findviewById(R.id.toolbar_layout);
    setSupportActionBar(toolbar);
}
</code></pre><h3 id="参考文章">参考文章</h3><ol>
<li><a href="http://hukai.me/android-dev-patterns/" target="_blank" rel="external">Android开发最佳实践</a></li>
</ol>
</span>
        
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <header class="post-header">

      
      
        <h1 class="post-title" itemprop="name headline">
          
          
            
              <a class="post-title-link" href="/2015/09/24/Touch事件的传递机制/" itemprop="url">
                Touch事件的传递机制
              </a>
            
          
        </h1>
      

      <div class="post-meta">
        <span class="post-time">
          Veröffentlicht am
          <time itemprop="dateCreated" datetime="2015-09-24T15:57:16+08:00" content="2015-09-24">
            2015-09-24
          </time>
        </span>

        
          <span class="post-category" >
            &nbsp; | &nbsp; in
            
              <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                <a href="/categories/Android/" itemprop="url" rel="index">
                  <span itemprop="name">Android</span>
                </a>
              </span>

              
              

            
          </span>
        

        
          
            <span class="post-comments-count">
              &nbsp; | &nbsp;
              <a href="/2015/09/24/Touch事件的传递机制/#comments" itemprop="discussionUrl">
                <span class="post-comments-count ds-thread-count" data-thread-key="2015/09/24/Touch事件的传递机制/" itemprop="commentsCount"></span>
              </a>
            </span>
          
        
      </div>
    </header>

    <div class="post-body">

      
      

      
        
          <span itemprop="articleBody"><p>图示：</p>
<p><img src="https://github.com/zhanfangzxc/zhanfangzxc.github.io/blob/source/source/_posts/Touch%E4%BA%8B%E4%BB%B6%E4%BC%A0%E9%80%92.jpg?raw=true" alt="Touch事件传递"></p>
<p>这篇文章为收集整理别人的内容，所以非常感谢那些默默付出的大牛们，正是有你们的付出，才让我不断的进步，感谢。</p>
<p>以下图片中的黑色箭头为<strong>ACTION_DOWN</strong>事件的分发顺序，绿色箭头是<strong>ACTION_UP</strong>和<strong>ACTION_MOVE</strong>的事件分发顺序。</p>
<h4 id="ViewGroup和View都不消耗事件，最终交给Activity消耗">ViewGroup和View都不消耗事件，最终交给Activity消耗</h4><p><img src="http://fangjie.info/wp-content/uploads/2015/09/view1-1024x629.png" alt="Activity消耗事件"></p>
<p>实际开发中我们经常会<strong>setOnTouchListener</strong>，这个会在<strong>onTouchEvent</strong>之前调用，如果这个方法返回false的话，那么事件会传递到<strong>onTouchEvent</strong>;如果返回true，相当于拦截了事件。</p>
<h4 id="Touch的区域是在ViewGroup之内，View之外">Touch的区域是在ViewGroup之内，View之外</h4><p><img src="http://fangjie.info/wp-content/uploads/2015/09/view2.png" alt="Touch ViewGroup"></p>
<h4 id="View消耗事件">View消耗事件</h4><p><img src="http://fangjie.info/wp-content/uploads/2015/09/view3.png" alt="View消耗事件"></p>
<h4 id="ViewGroup消耗事件，但经过View传递">ViewGroup消耗事件，但经过View传递</h4><p><img src="http://fangjie.info/wp-content/uploads/2015/09/view4.png" alt="ViewGroup消耗事件">      </p>
<h4 id="ViewGroup消耗事件，但是不经过View传递">ViewGroup消耗事件，但是不经过View传递</h4><p><img src="http://fangjie.info/wp-content/uploads/2015/09/view5.png" alt="ViewGroup"></p>
<h4 id="参考文章">参考文章</h4><p>图解View的事件分发机制:<a href="http://fangjie.info/%E5%9B%BE%E8%A7%A3view%E7%9A%84%E4%BA%8B%E4%BB%B6%E5%88%86%E5%8F%91%E6%9C%BA%E5%88%B6/?utm_source=tuicool" target="_blank" rel="external">http://fangjie.info/%E5%9B%BE%E8%A7%A3view%E7%9A%84%E4%BA%8B%E4%BB%B6%E5%88%86%E5%8F%91%E6%9C%BA%E5%88%B6/?utm_source=tuicool</a></p>
</span>
        
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <header class="post-header">

      
      
        <h1 class="post-title" itemprop="name headline">
          
          
            
              <a class="post-title-link" href="/2015/09/23/学习计划/" itemprop="url">
                学习计划
              </a>
            
          
        </h1>
      

      <div class="post-meta">
        <span class="post-time">
          Veröffentlicht am
          <time itemprop="dateCreated" datetime="2015-09-23T16:22:08+08:00" content="2015-09-23">
            2015-09-23
          </time>
        </span>

        

        
          
            <span class="post-comments-count">
              &nbsp; | &nbsp;
              <a href="/2015/09/23/学习计划/#comments" itemprop="discussionUrl">
                <span class="post-comments-count ds-thread-count" data-thread-key="2015/09/23/学习计划/" itemprop="commentsCount"></span>
              </a>
            </span>
          
        
      </div>
    </header>

    <div class="post-body">

      
      

      
        
          <span itemprop="articleBody"><p><strong>appcompat v21</strong>:<a href="https://chris.banes.me/2014/10/17/appcompat-v21/" target="_blank" rel="external">https://chris.banes.me/2014/10/17/appcompat-v21/</a></p>
<p><strong>RxJava</strong>:<a href="https://mcxiaoke.gitbooks.io/rxdocs/content/topics/Getting-Started.html" target="_blank" rel="external">https://mcxiaoke.gitbooks.io/rxdocs/content/topics/Getting-Started.html</a></p>
<p><a href="http://gank.io/post/560e15be2dca930e00da1083" target="_blank" rel="external">http://gank.io/post/560e15be2dca930e00da1083</a></p>
<p><strong>内存分析解决案例</strong>:<a href="http://www.csdn.net/article/2015-09-07/2825631" target="_blank" rel="external">http://www.csdn.net/article/2015-09-07/2825631</a></p>
<h3 id="SDK_V23">SDK V23</h3><p><strong>Android M运行时权限</strong>:<a href="http://android.jobbole.com/81527/" target="_blank" rel="external">http://android.jobbole.com/81527/</a></p>
</span>
        
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <header class="post-header">

      
      
        <h1 class="post-title" itemprop="name headline">
          
          
            
              <a class="post-title-link" href="/2015/09/22/Fragment介绍/" itemprop="url">
                Fragment介绍
              </a>
            
          
        </h1>
      

      <div class="post-meta">
        <span class="post-time">
          Veröffentlicht am
          <time itemprop="dateCreated" datetime="2015-09-22T10:28:32+08:00" content="2015-09-22">
            2015-09-22
          </time>
        </span>

        
          <span class="post-category" >
            &nbsp; | &nbsp; in
            
              <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                <a href="/categories/Fragment/" itemprop="url" rel="index">
                  <span itemprop="name">Fragment</span>
                </a>
              </span>

              
              

            
          </span>
        

        
          
            <span class="post-comments-count">
              &nbsp; | &nbsp;
              <a href="/2015/09/22/Fragment介绍/#comments" itemprop="discussionUrl">
                <span class="post-comments-count ds-thread-count" data-thread-key="2015/09/22/Fragment介绍/" itemprop="commentsCount"></span>
              </a>
            </span>
          
        
      </div>
    </header>

    <div class="post-body">

      
      

      
        
          <span itemprop="articleBody"><p>原文:<a href="http://developer.android.com/intl/zh-cn/guide/components/fragments.html#CommunicatingWithActivity" target="_blank" rel="external">http://developer.android.com/intl/zh-cn/guide/components/fragments.html#CommunicatingWithActivity</a></p>
<h3 id="Fragment介绍">Fragment介绍</h3><p><strong>Fragment</strong>是可以在Activity中替换的用户行为和用户接口，多个Fragment之间的相互作用是通过<strong>FragmentManager</strong>，而FragmentManager是可以通过<strong>Activity.getFragmentManager()</strong>和<strong>Fragment.getFragmentManager()</strong>.</p>
<p><strong>Fragment</strong>拥有自己的生命周期，但是他的生命周期同时又依赖Activity的生命周期，Fragment和Activity是密切相关的，不能单独使用，如果Activity的状态是stopped，那么这个Activity中的Fragment也将处于stopped的状态，当所有的Activity被回收的时候，所有的fragments也将会被回收。</p>
<h3 id="Fragment的生命周期">Fragment的生命周期</h3><p><img src="http://developer.android.com/images/fragment_lifecycle.png" alt="Fragment生命周期"></p>
<ul>
<li>onAttach():当Fragment和Activity建立联系的时候调用</li>
<li>onCreate(Bundle):初始化创建Fragment的时候调用</li>
<li>onCreateView(LayoutInflater,ViewGroup,Bundle):创建并返回与之关联的view视图</li>
<li>onActivityCreated(Bundle):告诉Fragment，Activity已经完成自己的<strong>Activity.onCreate()</strong>方法</li>
<li>onViewStateRestored(Bundle):告诉Fragment，保存的所有view视图中的状态都已经恢复了</li>
<li>onStart():使Fragment对用户可见</li>
<li>onResume():使Fragment开始与用户交互</li>
</ul>
<p>当这个Fragment不再使用的时候，将会回掉如下方法:</p>
<ul>
<li>onPause():Fragment不再与用户交互，因为activity的状态为paused或者Fragment操作被修改了</li>
<li>onStop():fragment对用户不可见，因为activity的状态为stopped或者activity中的Fragment被修改了</li>
<li>onDestoryView():允许Fragment清理与视图相关联的资源</li>
<li>onDestory():最后清理Fragment的状态</li>
<li>onDetach():当Fragment与activity失去关联的时候调用</li>
</ul>
<h3 id="添加一个用户界面">添加一个用户界面</h3><p>Fragment经常被用作Activity的一部分，为Fragment提供一个布局，需要实现<strong>onCreate()</strong>方法，当Fragment绘制布局的时候由Android系统调用,你实现这个方法的时候必须返回一个<strong>View</strong>。</p>
<p>注意:如果你的Fragment是<strong>ListFragment</strong>的子类，<strong>onCreateView</strong>方法的默认实现方式会返回一个<strong>ListView</strong>，所以你不需要再去实现这个方法。</p>
<pre><code>public static <span class="class"><span class="keyword">class</span> <span class="title">ExampleFragment</span> <span class="keyword"><span class="keyword">extends</span></span> <span class="title">Fragment</span>{</span>
    <span class="annotation">@Override</span>
    public <span class="type">View</span> onCreateView(<span class="type">LayoutInflater</span> inflater,<span class="type">ViewGroup</span> container,<span class="type">Bundle</span> savedInstanceState){
        <span class="keyword">return</span> inflater.inflate(<span class="type">R</span>.layout.example_fragment,container,<span class="literal">false</span>);
    }
}

<span class="comment">//这里缺少对改方法的解释</span>
</code></pre><h3 id="向Activity添加一个Fragment">向Activity添加一个Fragment</h3><p>Fragment经常被作为activity的一部分添加进去，这里提供两种添加Fragment的方法：</p>
<ul>
<li><p>在Activity布局文件中声明Fragment</p>
<pre><code>&lt;?xml <span class="property">version</span>=<span class="string">"1.0"</span> encoding=<span class="string">"utf-8"</span>&gt;
&lt;LinearLayout xmlns:android=<span class="string">"http://schemas.android.com/apk/res/android"</span>
    android:orientation=<span class="string">"horizontal"</span>
    android:layout_width=<span class="string">"match_parent"</span>
    android:layout_height=<span class="string">"match_parent"</span>&gt;

    &lt;fragment android:<span class="property">name</span>=<span class="string">"com.example.news.ArticleListFragment"</span>
            android:<span class="property">id</span>=<span class="string">"@+id/list"</span>
            android:layout_weight=<span class="string">"1"</span>
            android:layout_width=<span class="string">"0dp"</span>
            android:layout_height=<span class="string">"match_parent"</span> /&gt;
    &lt;fragment android:<span class="property">name</span>=<span class="string">"com.example.news.ArticleReaderFragment"</span>
            android:<span class="property">id</span>=<span class="string">"@+id/viewer"</span>
            android:layout_weight=<span class="string">"2"</span>
            android:layout_width=<span class="string">"0dp"</span>
            android:layout_height=<span class="string">"match_parent"</span> /&gt;
&lt;/LinearLayout&gt;
</code></pre></li>
</ul>
<p>每个Fragment需要一个唯一的标识符用来当activity重启的时候恢复Fragment，你可以使用他来执行捕获Fragment来执行事务，比如说移除它，这里有三种给Fragment提供id的方法：</p>
<ul>
<li>提供一个<strong>android:id</strong>作为Fragment的唯一标识符</li>
<li>提供一个<strong>android:tag</strong>作为一个唯一标识符</li>
<li>如果同时提供两者的话，系统会优先使用id</li>
</ul>
<h3 id="或者，向一个已经存在的ViewGroup中自动添加一个Fragment">或者，向一个已经存在的ViewGroup中自动添加一个Fragment</h3><p>在acticity运行的任何时候，都可以向activity布局中添加Fragment，具体代码：</p>
<pre><code>FragmentManager <span class="keyword">fragment</span>Manager = getFragmentManager();
FragmentTransaction <span class="keyword">fragment</span>Transaction = <span class="keyword">fragment</span>Manager.beginTransaction();
ExampleFragment <span class="keyword">fragment</span> = new ExampleFragment();
<span class="keyword">fragment</span>Transaction.add(R.id.fragment_container,<span class="keyword">fragment</span>);
<span class="keyword">fragment</span>Transaction.commit();
</code></pre><p><strong>add()</strong>方法的第一个参数是一个将会被Fragment替换的ViewGroup，是一个资源id，第二个参数是将要添加的Fragment。</p>
<p>如果你想要通过<strong>FragmentTransaction</strong>改变状态，你需要调用<strong>commit</strong>方法来使改变起作用。</p>
<h3 id="管理Fragments">管理Fragments</h3><p>在你的activity中管理Fragment需要使用<strong>FragmentManager</strong>，在activity中调用<strong>getFragmentManager()</strong>来获得<strong>FragmentManager</strong>。</p>
<p>你可以使用<strong>FragmentManager</strong>做以下事情:</p>
<ul>
<li>获取在activity中存在的Fragment，使用<strong>findFragmentById()</strong>或者<strong>findFragmentByTag()</strong></li>
<li>从回退栈中弹出Fragment。使用<strong>popBackStack()</strong></li>
<li>当回退栈改变的时候，注册一个监听器，使用<strong>addOnBackStackChangedListener</strong></li>
</ul>
<p>如果想了解更多关于这些方法和其他方法的信息，请参考<strong>FragmentManager</strong>类的文档。</p>
<p>还可以使用<strong>FragmentManager</strong>开启一个事务，然后执行事务，比如添加和移除Fragment。</p>
<h3 id="执行Fragment事务">执行Fragment事务</h3><p>使用Fragment最大的特色就是可以在activity中对他们执行添加、移除、替换以及其他的行为，你还可以保存事务到一个由acticvity管理的后退栈中。</p>
<p>你可以从<strong>FragmentManager</strong>中获取一个<strong>FragmentTransaction</strong>事务</p>
<pre><code>FragmentManager <span class="keyword">fragment</span>Manager = getFragmentManager();
FragmentTransaction <span class="keyword">fragment</span>Transaction = <span class="keyword">fragment</span>Manager.beginTransaction();
</code></pre><p>每个事务是你想同时执行的一组改变，你可以使用<strong>add()</strong>，<strong>remove()</strong>，<strong>replace()</strong>方法，然后把这些事务应用到activity上，需要使用<strong>commit</strong>方法。</p>
<p>在你执行<strong>commit</strong>方法之前，你想要调用<strong>addToBackStack()</strong>把Fragment事务添加到一个后退栈中，这个后退栈是由activity管理的，允许用户按返回键的时候返回前一个Fragment的状态。</p>
<pre><code>Fragment newFragment = new ExampleFragment();
FragmentTransaction <span class="keyword">transaction</span> = getFragmentManager().beginTransaction();

<span class="keyword">transaction</span>.replace(R.<span class="property">id</span>.fragment_container,newFragment);
<span class="keyword">transaction</span>.addToBackStack(null);
<span class="keyword">transaction</span>.commit();
</code></pre><p>如果你向事务中添加了多个改变，然后调用<strong>addToBackStack()</strong>中的时候，在你调用commit方法之前，所有的改变都会被当成一个单独的事务添加到回退栈中，如果你点击了后退按钮，会把那些所有的改变全都回转过来。</p>
<p>你向<strong>FragmentTransaction</strong>中添加变化的时候，需要注意的是：</p>
<ul>
<li>你必须在最后调用<strong>commit()</strong></li>
<li>当你添加了多个fragments向同一个container中时，你添加的顺序也就是你出现的顺序。</li>
</ul>
<p>当执行一个移除fragment的事务的时候，如果没有调用<strong>addToBackStack()</strong>方法，那么Fragment将会被回收，当用户操作返回按钮的时候，将不会出现被移除的Fragment；当调用<strong>addToBackStack()</strong>方法的时候，Fragment并没有被移除，而是stopped</p>
<blockquote>
<p>如果在Fragment事务中想执行一个过度动画雨啊的话，需要在调用<strong>commit()</strong>方法之前调用<strong>setTransition()</strong>。</p>
</blockquote>
<p>调用<strong>Commit()</strong>方法并不能理解执行事务，相反的，这个事务实在activity的ui线程(也称主线程)执行的，然而你可以从ui线程调用<strong>executePendingTransaction()</strong>来利己执行提交事务，当然没必要这样做，除非别的线程的工作依赖这个事务的提交。</p>
<h3 id="和Activity交互">和Activity交互</h3><p>Fragment可以通过<strong>getActivity()</strong>来获取Activity的实例，而且可以轻松执行任务，比如说查找activity布局中的view。</p>
<pre><code>View listView = getActivity().findViewById(R.<span class="property">id</span>.<span class="type">list</span>);
</code></pre><p>在activity中也可以通过<strong>FragmentManager</strong>中的一些方法来获取Fragment的实例，比如<strong>findFragmentById()</strong>或者<strong>findFragmentByTag()</strong></p>
<pre><code>ExampleFragment fragment = (ExampleFragment)getFragmentManager().findFragmentById(R.<span class="property">id</span>.example_fragment);
</code></pre><h3 id="向Activity创建一个事件回调">向Activity创建一个事件回调</h3><p>有时候，Fragment需要向Activity分享一个事件，一个很好的做法就是在Fragment中定义一个回调接口然后需要在activity中实现它，当一个activity通过这个接口接收到一个回掉的时候，可以向其它Fragment分享信息。</p>
<p>当一个新闻app在一个activity中存在两个Fragment，一个用来显示新闻列表，一个用来显示文章，所以FragmentA必须告诉FragmentB哪一篇文章被选择了，所以在这个列表中，新闻列表Fragment必须声明一个<strong>OnArticleSelectedListener</strong>接口:</p>
<pre><code>public static <span class="class"><span class="keyword">class</span> <span class="title">FragmentA</span> <span class="keyword"><span class="keyword">extends</span></span> <span class="title">ListFragment</span>{</span>
    public interface <span class="type">OnArticleSelectedListener</span>{
        public void onArticleSelected(<span class="type">Uri</span> articleUri);
    }
}
</code></pre><p>然后在activity中需要实现<strong>OnArticleSelectedListener</strong>接口，并且重写<strong>onArticleSelected()</strong>，将从FragmentA中得到的事件通知FragmentB。为了确保activity实现了这个接口，FragmentA的<strong>onAttach()</strong>方法中必须初始化一个<strong>OnArticleSelectedListener</strong>由activity转换而来的实例。</p>
<pre><code>public static <span class="class"><span class="keyword">class</span> <span class="title">FragmentA</span> <span class="keyword"><span class="keyword">extends</span></span> <span class="title">ListFragment</span>{</span>
    <span class="type">OnArticleSelectedListener</span> mListener;

    <span class="annotation">@Override</span>
    puiblic void onAttach(<span class="type">Activity</span> activity){
        <span class="keyword">super</span>.onAttach(activity);
        <span class="keyword">try</span>{
            mListener = (<span class="type">OnArticleSelectedListener</span>)activity;
        }<span class="keyword">catch</span> (<span class="type">ClassCastException</span> e) {
            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="type">ClassCastException</span>(activity.toString() + <span class="string">" must implement OnArticleSelectedListener"</span>);
        }
    }
}
</code></pre><p>接下来就是传递事件的逻辑</p>
<pre><code>public static <span class="class"><span class="keyword">class</span> <span class="title">FragmentA</span> <span class="keyword"><span class="keyword">extends</span></span> <span class="title">ListFragment</span> {</span>
    <span class="type">OnArticleSelectedListener</span> mListener;
    ...
    <span class="annotation">@Override</span>
    public void onListItemClick(<span class="type">ListView</span> l, <span class="type">View</span> v, int position, long id) {
        <span class="comment">// Append the clicked item's row ID with the content provider Uri</span>
        <span class="type">Uri</span> noteUri = <span class="type">ContentUris</span>.withAppendedId(<span class="type">ArticleColumns</span>.<span class="type">CONTENT_URI</span>, id);
        <span class="comment">// Send the event and Uri to the host activity</span>
        mListener.onArticleSelected(noteUri);
    }
    ...
}
</code></pre><h3 id="向Action_Bar中添加条目">向Action Bar中添加条目</h3><p>Fragment可以通过实现<strong>onCreateOptionMenu()</strong>方法来向activity的选项菜单中添加菜单项。为了使这个方法接收到调用，所以你必须在<strong>onCreate</strong>方法中调用<strong>setHasOptionsMenu</strong>,表明Fragment将要添加选项到选项菜单中。</p>
<h3 id="管理Fragment的生命周期">管理Fragment的生命周期</h3><p>管理Fragment和管理activity的生命周期很像</p>
<p><img src="http://developer.android.com/images/activity_fragment_lifecycle.png" alt="Fragment和Activity的生命周期对比"></p>
<p>像activity一样，你可以用<strong>Bundle</strong>来保存一个Fragment的状态，当activity被杀死的时候，你需要保存Fragment的状态，当activity被恢复的时候，可以恢复那些状态，你可以在<strong>onSaveInstanceState()</strong>回调方法中保存Fragment的状态，并且通过<strong>onCreate，onCreateView，onActivityCreated()</strong>方法来恢复之前所保存的状态，更多关于保存状态的信息，请看activities文档。</p>
<p>有一些不同的是，Fragment和Activity是如何存储进各自的后退栈的，对于Activity来说，当一个Activity状态变为stopped的时候，由系统管理的activities后退栈会将当前回收的activity替换进后退栈，但是对于Fragment来说，只有在提交事务之前调用了<strong>addToBackStack()</strong>方法才能进入由activity管理的后退栈。</p>
</span>
        
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <header class="post-header">

      
      
        <h1 class="post-title" itemprop="name headline">
          
          
            
              <a class="post-title-link" href="/2015/09/21/翻译-数据绑定part-2/" itemprop="url">
                [翻译]数据绑定part 2
              </a>
            
          
        </h1>
      

      <div class="post-meta">
        <span class="post-time">
          Veröffentlicht am
          <time itemprop="dateCreated" datetime="2015-09-21T10:30:23+08:00" content="2015-09-21">
            2015-09-21
          </time>
        </span>

        
          <span class="post-category" >
            &nbsp; | &nbsp; in
            
              <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                <a href="/categories/Android/" itemprop="url" rel="index">
                  <span itemprop="name">Android</span>
                </a>
              </span>

              
              

            
          </span>
        

        
          
            <span class="post-comments-count">
              &nbsp; | &nbsp;
              <a href="/2015/09/21/翻译-数据绑定part-2/#comments" itemprop="discussionUrl">
                <span class="post-comments-count ds-thread-count" data-thread-key="2015/09/21/翻译-数据绑定part-2/" itemprop="commentsCount"></span>
              </a>
            </span>
          
        
      </div>
    </header>

    <div class="post-body">

      
      

      
        
          <span itemprop="articleBody"><p>上一篇文章，我们使一个基础的twitter客户端运行起来了，但是让我们有点不太理解为什么，所以现在我们就来了解一下数据绑定库都做了什么和如何工作的。</p>
<p>首先要做的就是在我们项目的顶级<strong>build.gradle</strong>文件中的<strong>buildscript</strong>模块中添加一个依赖项:</p>
<pre><code><span class="keyword">buildscript</span> {
    <span class="keyword">repositories</span> {
        jcenter()
    }
    <span class="keyword">dependencies</span> {
        <span class="keyword">classpath</span> <span class="string">'com.android.tools.build:gradle:1.3.0'</span>
        <span class="keyword">classpath</span> <span class="string">"com.android.databinding:dataBinder:1.0-rc1"</span>
    }
}

<span class="keyword">allprojects</span> {
    <span class="keyword">repositories</span> {
        jcenter()
    }
}
</code></pre><p>在子项目中的<strong>build.gradle</strong>文件中，我们需要添加一个构建插件:</p>
<pre><code>apply plugin: <span class="string">'com.android.application'</span>
apply plugin: <span class="string">'com.android.databinding'</span> //就是这一行

android {
    compileSdkVersion <span class="number">23</span>
    buildToolsVersion <span class="string">"23.0.0"</span>

    defaultConfig {
        applicationId <span class="string">"com.stylingandroid.databinding"</span>
        minSdkVersion <span class="number">7</span>
        targetSdkVersion <span class="number">23</span>
        versionCode <span class="number">1</span>
        versionName <span class="string">"1.0"</span>

        buildConfigField <span class="string">'String'</span>, <span class="string">'TWITTER_CONSUMER_KEY'</span>, <span class="string">"\"</span>${twitterConsumerKey}\<span class="string">""</span>
        buildConfigField <span class="string">'String'</span>, <span class="string">'TWITTER_CONSUMER_SECRET'</span>, <span class="string">"\"</span>${twitterConsumerSecret}\<span class="string">""</span>
        buildConfigField <span class="string">'String'</span>, <span class="string">'TWITTER_ACCESS_KEY'</span>, <span class="string">"\"</span>${twitterAccessKey}\<span class="string">""</span>
        buildConfigField <span class="string">'String'</span>, <span class="string">'TWITTER_ACCESS_SECRET'</span>, <span class="string">"\"</span>${twitterAccessSecret}\<span class="string">""</span>
    }
    buildTypes {
        release {
            minifyEnabled false
            proguardFiles getDefaultProguardFile(<span class="string">'proguard-android.txt'</span>), <span class="string">'proguard-rules.pro'</span>
        }
    }
    packagingOptions {
        exclude <span class="string">'META-INF/LICENSE.txt'</span>
    }
    lintOptions {
        disable <span class="string">'InvalidPackage'</span>
    }
}

dependencies {
    compile <span class="string">'com.android.support:support-annotations:23.0.0'</span>
    compile <span class="string">'com.android.support:design:23.0.0'</span>
    compile <span class="string">'com.android.support:appcompat-v7:23.0.0'</span>
    compile <span class="string">'com.android.support:recyclerview-v7:23.0.0'</span>
    compile <span class="string">'org.twitter4j:twitter4j-core:4.0.4'</span>
    compile <span class="string">'org.twitter4j:twitter4j-async:4.0.4'</span>
    compile <span class="string">'com.github.bumptech.glide:glide:3.6.1'</span>
}
</code></pre><p>值得一提的是这里没有关于数据绑定的编译库添加进去，只是一个简单的构建项的添加。</p>
<p>这可以对于即将发生的事情，给我们一个线索，数据绑定是通过在执行的过程中构建和生成的样板式的代码，通常与绑定数据到视图有关。</p>
<p>在我们的例子中，他解析布局文件和检测被<strong>layout</strong>包装器在<strong>layout/status_item.xml</strong>,基于上面的文件名称，会自动生成一个数据绑定类，命名为<strong>StatusItemBinding</strong>，而且这是一个会在ViewHolder实现类中引用的神秘的类。</p>
<p>然后数据绑定会剔除被<layout>包装的代码，然后移除数据绑定表达式，最后将这些合并成<strong>StatusItemBinding</strong>类，换句话说就是将他转变成一个标准的Android xml文件，并且添加一个java类在运行时实现了绑定。</layout></p>
<p>所以我们现在再看<strong>StatusViewHolder</strong>的时候就会感觉很清晰，而且也明白了是怎么回事:</p>
<pre><code>public <span class="class"><span class="keyword">class</span> <span class="title">StatusViewHolder</span> <span class="keyword"><span class="keyword">extends</span></span> <span class="title">RecyclerView</span>.<span class="title">ViewHolder</span>{</span>
    <span class="keyword">private</span> <span class="type">StatusItemBinding</span> binding;

    public <span class="type">StatusViewHolder</span>(<span class="type">View</span> itemView){
        <span class="keyword">super</span>(itemView);
        binding = <span class="type">DataBinding</span>.bind(itemView);    } 

    public void bind(<span class="type">Status</span> status){
        binding.setStatus(status);
    }
}
</code></pre><p>在构造函数中我们调用<strong>DataBindingUtil.bind(itemView)</strong>将会在构建过程中生成一个StatusItemBinding，然后在<strong>bind(Status status)</strong>方法中我们将会调用一个setter在StatusItemBinding实例中，这个setter是在我们原始布局中声明的类型为<strong>.data.Status</strong>,命名为status的<strong><data></data></strong>节点生成的，当我们调用settter的时候，它将会从原始布局中提取数据绑定表达式执行必要的绑定。</p>
<p>现在我们更好的理解了他是怎么工作的而且为什么当app运行的时候我们能看到tweets的列表</p>
<p><img src="https://blog.stylingandroid.com/wp-content/uploads/2015/08/Part11-1024x768.png" alt="https://blog.stylingandroid.com/wp-content/uploads/2015/08/Part11-1024x768.png"></p>
<p>非常好，一个简单的布局，有三个items被绑定，并没有节省我们多少时间，只是对于TextView来说省去了找views和设置内容的时间。然而并没有结束，这里还可以为我们做好多关于数据绑定的事情，当我们从Twitter中提取出了image URL之后，然后将他绑定到ImageView中之后，图片却并没有显示出来，我们需要包含一个图像加载库，在下一篇文章中，我们将看到怎样通过数据绑定自动加载图片。</p>
<p>在这篇文章中主要是一些说明，并没有增加额外的代码，所以我们可以使用上一篇文章中的代码。</p>
</span>
        
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <header class="post-header">

      
      
        <h1 class="post-title" itemprop="name headline">
          
          
            
              <a class="post-title-link" href="/2015/09/19/Espresso测试/" itemprop="url">
                Espresso测试
              </a>
            
          
        </h1>
      

      <div class="post-meta">
        <span class="post-time">
          Veröffentlicht am
          <time itemprop="dateCreated" datetime="2015-09-19T16:34:50+08:00" content="2015-09-19">
            2015-09-19
          </time>
        </span>

        
          <span class="post-category" >
            &nbsp; | &nbsp; in
            
              <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                <a href="/categories/Android/" itemprop="url" rel="index">
                  <span itemprop="name">Android</span>
                </a>
              </span>

              
              

            
          </span>
        

        
          
            <span class="post-comments-count">
              &nbsp; | &nbsp;
              <a href="/2015/09/19/Espresso测试/#comments" itemprop="discussionUrl">
                <span class="post-comments-count ds-thread-count" data-thread-key="2015/09/19/Espresso测试/" itemprop="commentsCount"></span>
              </a>
            </span>
          
        
      </div>
    </header>

    <div class="post-body">

      
      

      
        
          <span itemprop="articleBody"><p>Espresso备忘单:</p>
<p><img src="https://google.github.io/android-testing-support-library/assets/espresso-cheat-sheet-2.1.0.png" alt="备忘单"></p>
</span>
        
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
  </section>

  
  <nav class="pagination">
    <span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><a class="extend next" rel="next" href="/page/2/">&raquo;</a>
  </nav>

 </div>

        

        
      </div>

      
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    <div class="sidebar-inner">

      

      <section class="site-overview">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <img class="site-author-image" src="http://img4.duitang.com/uploads/item/201405/07/20140507210553_NQGUP.thumb.600_0.jpeg" alt="坚持远方" itemprop="image"/>
          <p class="site-author-name" itemprop="name">坚持远方</p>
        </div>
        <p class="site-description motion-element" itemprop="description">既然选择远方，便只顾风雨兼程</p>
        <nav class="site-state motion-element">
          <div class="site-state-item site-state-posts">
            <a href="/archives">
              <span class="site-state-item-count">17</span>
              <span class="site-state-item-name">Artikel</span>
            </a>
          </div>

          <div class="site-state-item site-state-categories">
            <a href="/categories">
              <span class="site-state-item-count">2</span>
              <span class="site-state-item-name">Kategorien</span>
              </a>
          </div>

          <div class="site-state-item site-state-tags">
            <a href="/tags">
              <span class="site-state-item-count">21</span>
              <span class="site-state-item-name">Tags</span>
              </a>
          </div>

        </nav>

        
          <div class="feed-link motion-element">
            <a href="/atom.xml" rel="alternate">
              <i class="menu-item-icon icon-next-feed"></i>
              RSS
            </a>
          </div>
        

        <div class="links-of-author motion-element">
          
            
              <span class="links-of-author-item">
                <a href="https://github.com/zhanfangzxc" target="_blank">GitHub</a>
              </span>
            
              <span class="links-of-author-item">
                <a href="http://weibo.com/5497967279" target="_blank">Weibo</a>
              </span>
            
          
        </div>

        
        

        <div class="links-of-author motion-element">
          
        </div>

      </section>

      

    </div>
  </aside>


    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner"> <div class="copyright" >
  
  &copy; &nbsp; 
  <span itemprop="copyrightYear">2015</span>
  <span class="with-love">
    <i class="icon-next-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">赵珊珊</span>
</div>

<div class="powered-by">
  Erstellt mit  <a class="theme-link" href="http://hexo.io">Hexo</a>
</div>

<div class="theme-info">
  Theme -
  <a class="theme-link" href="https://github.com/iissnan/hexo-theme-next">
    NexT
  </a>
</div>


 </div>
    </footer>

    <div class="back-to-top"></div>
  </div>

  <script type="text/javascript" src="/vendors/jquery/index.js?v=2.1.3"></script>

  
  
  
    

  
    
  

  <script type="text/javascript">
    var duoshuoQuery = {short_name:"zhaoshanshan"};
    (function() {
      var ds = document.createElement('script');
      ds.type = 'text/javascript';ds.async = true;
      ds.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') + '//static.duoshuo.com/embed.js';
      ds.charset = 'UTF-8';
      (document.getElementsByTagName('head')[0]
      || document.getElementsByTagName('body')[0]).appendChild(ds);
    })();
  </script>
    
     

    
  
  
  <script type="text/javascript" src="/vendors/fancybox/source/jquery.fancybox.pack.js"></script>
  <script type="text/javascript" src="/js/fancy-box.js?v=0.4.5.1"></script>


  <script type="text/javascript" src="/js/helpers.js?v=0.4.5.1"></script>
  

  <script type="text/javascript" src="/vendors/velocity/velocity.min.js"></script>
  <script type="text/javascript" src="/vendors/velocity/velocity.ui.min.js"></script>

  <script type="text/javascript" src="/js/motion_global.js?v=0.4.5.1" id="motion.global"></script>




  <script type="text/javascript" src="/js/nav-toggle.js?v=0.4.5.1"></script>
  <script type="text/javascript" src="/vendors/fastclick/lib/fastclick.min.js?v=1.0.6"></script>

  

  <script type="text/javascript">
    $(document).ready(function () {
      if (CONFIG.sidebar === 'always') {
        displaySidebar();
      }
      if (isMobile()) {
        FastClick.attach(document.body);
      }
    });
  </script>

  

  
  

  
  <script type="text/javascript" src="/js/lazyload.js"></script>
  <script type="text/javascript">
    $(function () {
      $("#posts").find('img').lazyload({
        placeholder: "/images/loading.gif",
        effect: "fadeIn"
      });
    });
  </script>
</body>
</html>
