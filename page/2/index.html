<!doctype html>
<html class="theme-next use-motion ">
<head>
  

<meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>


<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />








  <link rel="stylesheet" type="text/css" href="/vendors/fancybox/source/jquery.fancybox.css?v=2.1.5"/>



  <link href='//fonts.googleapis.com/css?family=Lato:300,400,700,400italic&subset=latin,latin-ext' rel='stylesheet' type='text/css'>


<link rel="stylesheet" type="text/css" href="/css/main.css?v=0.4.5.1"/>


    <meta name="description" content="既然选择远方，便只顾风雨兼程" />



  <meta name="keywords" content="Hexo,next" />



  <link rel="alternate" href="/atom.xml" title="ZhaoShanShan’s Blog" type="application/atom+xml" />



  <link rel="shorticon icon" type="image/x-icon" href="/favicon.ico?v=0.4.5.1" />


<meta name="description" content="既然选择远方，便只顾风雨兼程">
<meta property="og:type" content="website">
<meta property="og:title" content="ZhaoShanShan’s Blog">
<meta property="og:url" content="http://zhaoshanshan.me/page/2/index.html">
<meta property="og:site_name" content="ZhaoShanShan’s Blog">
<meta property="og:description" content="既然选择远方，便只顾风雨兼程">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="ZhaoShanShan’s Blog">
<meta name="twitter:description" content="既然选择远方，便只顾风雨兼程">


<script type="text/javascript" id="hexo.configuration">
  var CONFIG = {
    scheme: '',
    sidebar: 'always'
  };
</script>

  <title> ZhaoShanShan’s Blog </title>
</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-CN">

  <!--[if lte IE 8]>
  <div style=' clear: both; height: 59px; padding:0 0 0 15px; position: relative;margin:0 auto;'>
    <a href="http://windows.microsoft.com/en-US/internet-explorer/products/ie/home?ocid=ie6_countdown_bannercode">
      <img src="http://7u2nvr.com1.z0.glb.clouddn.com/picouterie.jpg" border="0" height="42" width="820"
           alt="You are using an outdated browser. For a faster, safer browsing experience, upgrade for free today or use other browser ,like chrome firefox safari."
           style='margin-left:auto;margin-right:auto;display: block;'/>
    </a>
  </div>
<![endif]-->
  



  <div class="container one-column 
   page-home 
">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><h1 class="site-meta">
  <span class="logo-line-before"><i></i></span>
  <a href="/" class="brand" rel="start">
      <span class="logo">
        <i class="icon-next-logo"></i>
      </span>
      <span class="site-title">ZhaoShanShan’s Blog</span>
  </a>
  <span class="logo-line-after"><i></i></span>
</h1>

<div class="site-nav-toggle">
  <button>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
  </button>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu ">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            <i class="menu-item-icon icon-next-home"></i> <br />
            首頁
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories" rel="section">
            <i class="menu-item-icon icon-next-categories"></i> <br />
            分類
          </a>
        </li>
      
        
        <li class="menu-item menu-item-about">
          <a href="/about" rel="section">
            <i class="menu-item-icon icon-next-about"></i> <br />
            關於
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives" rel="section">
            <i class="menu-item-icon icon-next-archives"></i> <br />
            歸檔
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags" rel="section">
            <i class="menu-item-icon icon-next-tags"></i> <br />
            標籤
          </a>
        </li>
      

      
      
    </ul>
  

  
</nav>

 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div id="content" class="content"> 
  <section id="posts" class="posts-expand">
    
      

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <header class="post-header">

      
      
        <h1 class="post-title" itemprop="name headline">
          
          
            
              <a class="post-title-link" href="/2015/11/19/Intent常用操作/" itemprop="url">
                Intent常用操作
              </a>
            
          
        </h1>
      

      <div class="post-meta">
        <span class="post-time">
          發表於
          <time itemprop="dateCreated" datetime="2015-11-19T10:38:32+08:00" content="2015-11-19">
            2015-11-19
          </time>
        </span>

        

        
          
            <span class="post-comments-count">
              &nbsp; | &nbsp;
              <a href="/2015/11/19/Intent常用操作/#comments" itemprop="discussionUrl">
                <span class="post-comments-count ds-thread-count" data-thread-key="2015/11/19/Intent常用操作/" itemprop="commentsCount"></span>
              </a>
            </span>
          
        
      </div>
    </header>

    <div class="post-body">

      
      

      
        
          <span itemprop="articleBody"><h3 id="跳转到市场评分">跳转到市场评分</h3><p>Uri uri = Uri.parse(“market://details?id=”+getPackageName());<br>Intent intent = new Intent(Intent.ACTION_VIEW,uri);<br>intent.addFlags(Intent.FLAG_ACTIVITY_NEW_TASK);<br>startActivity(intent);</p>
<h3 id="市场内搜索">市场内搜索</h3><p>Intent intent = new Intent(Intent.ACTION_VIEW);<br>intent.setData(Uri.parse(“market://search?q=pub:Your Publisher Name”));<br>startActivity(intent);</p>
<h3 id="分享">分享</h3><p>Intent sendIntent = new Intent();<br>sendIntent.setAction(Intent.ACTION_SEND);<br>sendIntent.setType(“text/*”);<br>sendIntent.putExtra(Intent.EXTRA_TEXT,str);<br>startActivity(sendIntent);</p>
</span>
        
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <header class="post-header">

      
      
        <h1 class="post-title" itemprop="name headline">
          
          
            
              <a class="post-title-link" href="/2015/11/17/Webview操作整理/" itemprop="url">
                Webview操作整理
              </a>
            
          
        </h1>
      

      <div class="post-meta">
        <span class="post-time">
          發表於
          <time itemprop="dateCreated" datetime="2015-11-17T16:08:26+08:00" content="2015-11-17">
            2015-11-17
          </time>
        </span>

        

        
          
            <span class="post-comments-count">
              &nbsp; | &nbsp;
              <a href="/2015/11/17/Webview操作整理/#comments" itemprop="discussionUrl">
                <span class="post-comments-count ds-thread-count" data-thread-key="2015/11/17/Webview操作整理/" itemprop="commentsCount"></span>
              </a>
            </span>
          
        
      </div>
    </header>

    <div class="post-body">

      
      

      
        
          <span itemprop="articleBody"><p>如果你想在自己的项目中添加加载网页的功能的话，就需要使用Webview。</p>
<h3 id="添加WebView">添加WebView</h3><pre><code><span class="pi">&lt;?xml version="1.0" encoding="utf-8"?&gt;</span>
<span class="tag">&lt;<span class="title">WebView</span>  <span class="attribute">xmlns:android</span>=<span class="value">"http://schemas.android.com/apk/res/android"</span>
    <span class="attribute">android:id</span>=<span class="value">"@+id/webview"</span>
    <span class="attribute">android:layout_width</span>=<span class="value">"fill_parent"</span>
    <span class="attribute">android:layout_height</span>=<span class="value">"fill_parent"</span>
/&gt;</span>
</code></pre><ul>
<li><p>加载网页</p>
<pre><code>WebView myWebView = (WebView) findViewById(R.<span class="property">id</span>.webview);
myWebView.loadUrl(<span class="string">"http://www.example.com"</span>);
</code></pre></li>
<li><p>添加权限</p>
<pre><code><span class="tag">&lt;<span class="title">manifest</span> <span class="attribute">...</span> &gt;</span>
<span class="tag">&lt;<span class="title">uses-permission</span> <span class="attribute">android:name</span>=<span class="value">"android.permission.INTERNET"</span> /&gt;</span>
...
<span class="tag">&lt;/<span class="title">manifest</span>&gt;</span>
</code></pre></li>
</ul>
<h3 id="在WebView中使用JavaScript">在WebView中使用JavaScript</h3><p>JavaScript默认在Webview中是不可用的，但是你可以通过<strong>WebSettings</strong>让他变为可用，具体代码:</p>
<pre><code>WebView myWebView = (WebView) findViewById(R.id.webview)<span class="comment">;</span>
WebSettings webSettings = myWebView.getSettings()<span class="comment">;</span>
webSettings.setJavaScriptEnabled(true)<span class="comment">;</span>
</code></pre><p>WebSettings中还存在很多其他的有用的设置。</p>
<h3 id="将javaScript代码绑定到Android代码中">将javaScript代码绑定到Android代码中</h3><p>首先，在你的项目中添加如下类：</p>
<pre><code><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">WebAppInterface</span></span>{
    Context context;
    WebAppInterface(Context c){
        context = c;
    }

    <span class="annotation">@JavaScriptInterface</span>
    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">showToast</span><span class="params">()</span></span>{
         Toast.makeText(mContext, toast, Toast.LENGTH_SHORT).show();
    }
}
</code></pre><p>在targetSdkVersion为17或者更高的时候，需要添加<strong>@JavaScriptInterface</strong>到类中的每一个方法上。</p>
<p>绑定代码：</p>
<pre><code>WebView webView = (WebView) findViewById(R.id.webview);
webView.addJavascriptInterface(<span class="keyword">new</span> WebAppInterface(<span class="keyword">this</span>),<span class="string">"Android"</span>);
</code></pre><p>此时的html代码中必须要包含以下代码：</p>
<pre><code>&lt;input typpe=<span class="string">"button"</span> value=<span class="string">"Say hello"</span> onClick=<span class="string">"showAndroidToast('Hello Android!')"</span>

&lt;script <span class="built_in">type</span>=<span class="string">"text/javascript"</span>&gt;
    <span class="function"><span class="keyword">function</span> <span class="title">showAndroidToast</span><span class="params">(toast)</span></span>{
        Android.showToast(toast);
    }
&lt;/script&gt;
</code></pre><h3 id="处理Page导航">处理Page导航</h3><p>如果用户要在当前WebView中打开链接，可以使用<strong>setWebViewClient()</strong>为Webview设置<strong>WebviewClient</strong>，比如：</p>
<pre><code>WebView myWebView = (WebView)findViewById(R.id.webview)<span class="comment">;</span>
myWebView.setWebViewClient(new WebViewClient())<span class="comment">;</span>
</code></pre><p>现在，所有的用户点击的跳转都会在Webview中加载。</p>
<p>如果点击链接的时候，需要更多的控制，那么就需要创建自己的<strong>WebviewClient</strong>,然后覆盖<strong>shouldOverrideUrlLoading()</strong>方法，代码如下：</p>
<pre><code><span class="keyword">private</span> <span class="class"><span class="keyword">class</span> <span class="title">MyWebviewClient</span> <span class="keyword"><span class="keyword">extends</span></span> <span class="title">WebViewClient</span>{</span>
    <span class="annotation">@Override</span>
    public boolean shouldOverrideUrlLoading(<span class="type">WebView</span> view,<span class="type">String</span> url){
        <span class="keyword">if</span>(<span class="type">Uri</span>.parse(url).getHost().equals(<span class="string">"www.example.com"</span>)){
            <span class="comment">//让WebView加载网页</span>
            <span class="keyword">return</span> <span class="literal">false</span>;
        }
        <span class="comment">//不加载网页，跳到另外一Activity</span>
        <span class="type">Intent</span> intent = <span class="keyword">new</span> <span class="type">Intent</span>(<span class="type">Intent</span>.<span class="type">ACTION_VIEW</span>, <span class="type">Uri</span>.parse(url));
        startActivity(intent);
        <span class="keyword">return</span> <span class="literal">true</span>;
    }
}
</code></pre><p>最后：</p>
<pre><code>WebView myWebView = (WebView) findViewById(R.id.webview)<span class="comment">;</span>
myWebView.setWebViewClient(new MyWebViewClient())<span class="comment">;</span>
</code></pre><h3 id="操纵网页浏览历史">操纵网页浏览历史</h3><p>使用设备上的back健来操纵网页的前进后退:</p>
<pre><code><span class="annotation">@Override</span>
<span class="keyword">public</span> <span class="function"><span class="keyword">boolean</span> <span class="title">onKeyDown</span><span class="params">(<span class="keyword">int</span> keyCode,KeyEvent event)</span></span>{
    <span class="keyword">if</span>((keyCode == KeyEvent.KEYCODE_BACK)&amp;&amp;myWebView.canGoBack())
    {
        myWebView.goBack();
        <span class="keyword">return</span> <span class="keyword">true</span>;
    }
    <span class="function"><span class="keyword">return</span> <span class="keyword">super</span>.<span class="title">onKeyDown</span><span class="params">(keyCode,event)</span></span>;
}
</code></pre><h3 id="实现点击WebView中的图片预览的效果">实现点击WebView中的图片预览的效果</h3><p>代码：</p>
<pre><code><span class="comment">//在Html中添加Javascript代码</span>
<span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">addImageClickListner</span><span class="params">()</span> </span>{
        mWebView.loadUrl(<span class="string">"javascript:(function(){"</span> +
                <span class="string">"var objs = document.getElementsByTagName(\"img\"); "</span> +
                <span class="string">"for(var i=0;i&lt;objs.length;i++)  "</span> +
                <span class="string">"{"</span>
                + <span class="string">"    objs[i].onclick=function()  "</span> +
                <span class="string">"    {  "</span>
                + <span class="string">"        window.imagelistner.openImage(this.src);  "</span> +
                <span class="string">"    }  "</span> +
                <span class="string">"}"</span> +
                <span class="string">"})()"</span>);
    }

    <span class="comment">//创建自定义的WebviewClient</span>

    <span class="keyword">private</span> <span class="class"><span class="keyword">class</span> <span class="title">MyWebViewClient</span> <span class="keyword">extends</span> <span class="title">WebViewClient</span> </span>{
    <span class="annotation">@Override</span>
    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">shouldOverrideUrlLoading</span><span class="params">(WebView view, String url)</span> </span>{
        <span class="keyword">if</span> (url.endsWith(<span class="string">".jpg"</span>) || url.endsWith(<span class="string">".png"</span>) || url.endsWith(<span class="string">".gif"</span>)) {
            <span class="keyword">return</span> <span class="keyword">true</span>;
        } <span class="keyword">else</span> {
            <span class="keyword">return</span> <span class="keyword">false</span>;
        }
    }

    <span class="annotation">@Override</span>
    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onPageFinished</span><span class="params">(WebView view, String url)</span> </span>{

        view.getSettings().setJavaScriptEnabled(<span class="keyword">true</span>);
        mStatusLayout.showContentView(contentLayout);
        <span class="keyword">super</span>.onPageFinished(view, url);
        addImageClickListner();

    }

    <span class="annotation">@Override</span>
    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onPageStarted</span><span class="params">(WebView view, String url, Bitmap favicon)</span> </span>{
        view.getSettings().setJavaScriptEnabled(<span class="keyword">true</span>);

        <span class="keyword">super</span>.onPageStarted(view, url, favicon);
    }

    <span class="annotation">@Override</span>
    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onReceivedError</span><span class="params">(WebView view, <span class="keyword">int</span> errorCode, String description, String failingUrl)</span> </span>{

        <span class="keyword">super</span>.onReceivedError(view, errorCode, description, failingUrl);

    }
}

  <span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">JavascriptInterface</span> </span>{

    <span class="keyword">private</span> Context context;

    <span class="function"><span class="keyword">public</span> <span class="title">JavascriptInterface</span><span class="params">(Context context)</span> </span>{
        <span class="keyword">this</span>.context = context;
    }

    <span class="annotation">@android</span>.webkit.<span class="function">JavascriptInterface
    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title">openImage</span><span class="params">(String img)</span> </span>{
       <span class="comment">//预览图片的代码</span>
    }
}

<span class="comment">//最后一步</span>
  mWebView.addJavascriptInterface(<span class="keyword">new</span> JavascriptInterface(<span class="keyword">this</span>), <span class="string">"imagelistner"</span>);
</code></pre><h3 id="WebView拦截替换网络请求数据">WebView拦截替换网络请求数据</h3><p>如果想让WebView在处理网络请求的时候将某些请求拦截替换成某些特殊的资源，就需要用到下面的方法：</p>
<p><strong>shouldInterceptRequest</strong></p>
<p>示例代码：</p>
<pre><code>webview.setWebViewClient(<span class="keyword">new</span> WebViewClient(){
    <span class="annotation">@Override</span>
    <span class="keyword">public</span> <span class="function">WebResourceReponse <span class="title">shouldInterceptRequest</span><span class="params">(Webview view,String url)</span></span>{
        WebResourceResponse reponse = <span class="keyword">null</span>;
        <span class="keyword">if</span>(url.contains(<span class="string">"logo"</span>)){
            <span class="keyword">try</span> {
              InputStream localCopy = getAssets().open(<span class="string">"droidyue.png"</span>);
              response = <span class="keyword">new</span> WebResourceResponse(<span class="string">"image/png"</span>, <span class="string">"UTF-8"</span>, localCopy);
              } <span class="keyword">catch</span> (IOException e) {
              e.printStackTrace();
              }    
        }    
    }
})
</code></pre><p>WevResourceResponse需要设定耽搁属性，MIME类型，数据编码，数据流形式。</p>
<h3 id="常见问题汇总">常见问题汇总</h3><ul>
<li>Android 4.4中播放Html5的音频或视频，出现的<strong>E/chromium: [ERROR:in_process_view_renderer.cc(189)] Failed to request GL process. Deadlock likely: 0</strong>问题</li>
</ul>
<p>解决方案:<strong>mWebView.setLayerType(View.LAYER_TYPE_SOFTWARE, null);</strong></p>
<p>参考链接:<a href="https://code.google.com/p/android/issues/detail?id=63754" target="_blank" rel="external">https://code.google.com/p/android/issues/detail?id=63754</a></p>
<h3 id="参考文章">参考文章</h3><p><a href="http://droidyue.com/blog/2014/11/23/block-web-resource-in-webview/" target="_blank" rel="external">http://droidyue.com/blog/2014/11/23/block-web-resource-in-webview/</a></p>
<p><strong>WebView问题总结</strong>:<a href="http://blog.csdn.net/t12x3456/article/details/13769731" target="_blank" rel="external">http://blog.csdn.net/t12x3456/article/details/13769731</a></p>
<p><strong>WebView使用小结</strong>:<a href="http://blog.csdn.net/janice0529/article/details/41318755" target="_blank" rel="external">http://blog.csdn.net/janice0529/article/details/41318755</a></p>
</span>
        
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <header class="post-header">

      
      
        <h1 class="post-title" itemprop="name headline">
          
          
            
              <a class="post-title-link" href="/2015/11/05/创建和发布Android库的完整指南/" itemprop="url">
                创建和发布Android库的完整指南
              </a>
            
          
        </h1>
      

      <div class="post-meta">
        <span class="post-time">
          發表於
          <time itemprop="dateCreated" datetime="2015-11-05T11:18:33+08:00" content="2015-11-05">
            2015-11-05
          </time>
        </span>

        

        
          
            <span class="post-comments-count">
              &nbsp; | &nbsp;
              <a href="/2015/11/05/创建和发布Android库的完整指南/#comments" itemprop="discussionUrl">
                <span class="post-comments-count ds-thread-count" data-thread-key="2015/11/05/创建和发布Android库的完整指南/" itemprop="commentsCount"></span>
              </a>
            </span>
          
        
      </div>
    </header>

    <div class="post-body">

      
      

      
        
          <span itemprop="articleBody"><p>原文地址:<a href="https://medium.com/android-news/the-complete-guide-to-creating-an-android-library-46628b7fc879#.fpcy9pvc7" target="_blank" rel="external">https://medium.com/android-news/the-complete-guide-to-creating-an-android-library-46628b7fc879#.fpcy9pvc7</a></p>
<p>我一直很惊讶于那些Android开发社区中存在的许多又去的第三方开源库没很长时间依赖，我都希望贡献一些自己的开源库，但是我并不知道要怎么做。查询了很多关于如何发布Android开源库的文章之后，我仍然发现在很多不同地方查询到的信息中仍然有许多遗失的细节，所以我今天说明一下我自己的实现过程。</p>
<p>首先，我使用的是以Gradle为官方构建系统的Android Studio，来创建我左右的Android项目，下载<a href="https://developer.android.com/intl/zh-cn/sdk/index.html" target="_blank" rel="external">Android Studio</a>的最新版本。</p>
<h3 id="术语">术语</h3><p>在我们开始讲解之前先来了解一些术语：</p>
<p><strong>Project</strong>——Android Studio中创建的项目代表一个完整的Android App,Android Studio中的项目包含一个或多个模块，就像Eclipse中工作空间的概念。</p>
<p><strong>Module</strong>——一个模块是一个应用中的一个组建，可以独立的构建，测试或者调试。模块中包括你的应用相关的源代码和资源文件，Android Studio中的一个就像Eclipse中的一个工程。</p>
<p><strong>AAR</strong>——是一个Android库的二进制版本，一个库项目的主要输出就是一个.aar的包，他是一个编译代码(就像一个jar文件或者是.so文件)和资源文件(manifest,res,assets)的组合.</p>
<p><strong>Maven中央仓库</strong>——一个由Maven组织提供的仓库，它包括大量常用的开源库，搜索Maven可以浏览Maven中央仓库中的内容，<a href="">Gradle,Please</a>是另外一个允许你搜索Maven仓库的工具，Gradle使用的是jCenter协议，如果你再你的repositories节点(<a href="">Notes about jCenter</a>)写包含jCenter()的话,Maven中央仓库通常被称为Maven中央或中央仓库。</p>
<p><strong>Sonatype</strong>——Snoatype’s开源软件存储库主机主要是用来为项目所有者和贡献者提供发布他们的组件到中央仓库的服务。</p>
<p><strong>GPG</strong>——GNU隐私保护(GPG,也GnuPG),GNU项目的自由选择PGP加密软件符合OpenPGP(RFC4880)标准。使用GPG可以加密(解密)文件包含敏感数据,如电子受保护的健康信息(ePHI)由健康保险流通与责任法案(HIPAA)隐私和安全规则。更多GPG,请参阅GNU隐私保护的网站。(此段话全部使用翻译软件翻译)</p>
<h3 id="准备你的Android库">准备你的Android库</h3><p>我将会使用我的<a href="">Tresle</a>库作为一个示例，这里需要做一些修改才能发不到中央仓库</p>
<ul>
<li><p>将库的核心代码和库的使用示例的代码分开，我将这个库分成两个模块，一个是<strong>library</strong>，一个是<strong>sample</strong>。</p>
</li>
<li><p>在Sample模块的<strong>build.gradle</strong>中，一定要包含以下内容</p>
<pre><code>apply plugin: <span class="string">'com.android.application'</span>

<span class="keyword">dependencies</span> {
    <span class="keyword">compile</span> <span class="keyword">project</span>(<span class="string">':library'</span>)
}
</code></pre></li>
<li><p>在library模块的<strong>build.gradle</strong>文件中，要包含下面的内容</p>
<pre><code>apply <span class="string">plugin:</span> <span class="string">'com.android.library'</span>
apply <span class="string">from:</span> <span class="string">'maven-push.gradle'</span>
</code></pre></li>
<li><p>在library模块，添加一个<strong>gradle.properties</strong>文件，然后包含如下代码</p>
<pre><code><span class="setting">POM_NAME=<span class="value">ProjectName</span></span>
<span class="setting">POM_ARTOFACT_ID=<span class="value">projectname</span></span>
<span class="setting">POM_PACKAGING=<span class="value">aar</span></span>
</code></pre></li>
<li><p>在library模块中，添加一个<strong>maven-push.gradle</strong>文件，然后添加如下代码</p>
<pre><code><span class="comment">/*
 * Copyright 2013 Chris Banes
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */</span>

apply <span class="string">plugin:</span> <span class="string">'maven'</span>
apply <span class="string">plugin:</span> <span class="string">'signing'</span>

<span class="keyword">def</span> isReleaseBuild() {
    <span class="keyword">return</span> VERSION_NAME.contains(<span class="string">"SNAPSHOT"</span>) == <span class="literal">false</span>
}

<span class="keyword">def</span> getReleaseRepositoryUrl() {
    <span class="keyword">return</span> hasProperty(<span class="string">'RELEASE_REPOSITORY_URL'</span>) ? RELEASE_REPOSITORY_URL
            : <span class="string">"https://oss.sonatype.org/service/local/staging/deploy/maven2/"</span>
}

<span class="keyword">def</span> getSnapshotRepositoryUrl() {
    <span class="keyword">return</span> hasProperty(<span class="string">'SNAPSHOT_REPOSITORY_URL'</span>) ? SNAPSHOT_REPOSITORY_URL
            : <span class="string">"https://oss.sonatype.org/content/repositories/snapshots/"</span>
}

<span class="keyword">def</span> getRepositoryUsername() {
    <span class="keyword">return</span> hasProperty(<span class="string">'NEXUS_USERNAME'</span>) ? NEXUS_USERNAME : <span class="string">""</span>
}

<span class="keyword">def</span> getRepositoryPassword() {
    <span class="keyword">return</span> hasProperty(<span class="string">'NEXUS_PASSWORD'</span>) ? NEXUS_PASSWORD : <span class="string">""</span>
}

afterEvaluate { project -&gt;
    uploadArchives {
        repositories {
            mavenDeployer {
                beforeDeployment { MavenDeployment deployment -&gt; signing.signPom(deployment) }

                pom.groupId = GROUP
                pom.artifactId = POM_ARTIFACT_ID
                pom.version = VERSION_NAME

                repository(<span class="string">url:</span> getReleaseRepositoryUrl()) {
                    authentication(<span class="string">userName:</span> getRepositoryUsername(), <span class="string">password:</span> getRepositoryPassword())
                }
                snapshotRepository(<span class="string">url:</span> getSnapshotRepositoryUrl()) {
                    authentication(<span class="string">userName:</span> getRepositoryUsername(), <span class="string">password:</span> getRepositoryPassword())
                }

                pom.project {
                    name POM_NAME
                    packaging POM_PACKAGING
                    description POM_DESCRIPTION
                    url POM_URL

                    scm {
                        url POM_SCM_URL
                        connection POM_SCM_CONNECTION
                        developerConnection POM_SCM_DEV_CONNECTION
                    }

                    licenses {
                        license {
                            name POM_LICENCE_NAME
                            url POM_LICENCE_URL
                            distribution POM_LICENCE_DIST
                        }
                    }

                    developers {
                        developer {
                            id POM_DEVELOPER_ID
                            name POM_DEVELOPER_NAME
                        }
                    }
                }
            }
        }
    }

    signing {
        required { isReleaseBuild() &amp;&amp; gradle.taskGraph.hasTask(<span class="string">"uploadArchives"</span>) }
        sign configurations.archives
    }

    <span class="comment">//task androidJavadocs(type: Javadoc) {</span>
    <span class="comment">//source = android.sourceSets.main.allJava</span>
    <span class="comment">//}</span>

    <span class="comment">//task androidJavadocsJar(type: Jar, dependsOn: androidJavadocs) {</span>
    <span class="comment">//classifier = 'javadoc'</span>
    <span class="comment">//from androidJavadocs.destinationDir</span>
    <span class="comment">//}</span>

    task androidSourcesJar(<span class="string">type:</span> Jar) {
        classifier = <span class="string">'sources'</span>
        from android.sourceSets.main.java.sourceFiles
    }

    artifacts {
        archives androidSourcesJar
    }
}
</code></pre></li>
<li><p>修改你的项目根目录下的<strong>.gitigore</strong>文件</p>
<pre><code><span class="preprocessor"># [Android] ========================</span>
<span class="preprocessor"># Built application files</span>
*.apk
*.ap_

<span class="preprocessor"># Files for the Dalvik VM</span>
*.dex

<span class="preprocessor"># Java class files</span>
*.class

<span class="preprocessor"># Generated files</span>
bin/
gen/

<span class="preprocessor"># Gradle files</span>
.gradle/
build/

<span class="preprocessor"># Local configuration file (sdk path, etc)</span>
local.properties

<span class="preprocessor"># Proguard folder generated by Eclipse</span>
proguard/

<span class="preprocessor"># Log Files</span>
*.log
</code></pre></li>
</ul>
<pre><code><span class="preprocessor">## Directory-based project format:</span>
.idea/

<span class="preprocessor">## File-based project format:</span>
*.ipr
*.iws

<span class="preprocessor">## Plugin-specific files:</span>

<span class="preprocessor"># IntelliJ</span>
out/

<span class="preprocessor"># mpeltonen/sbt-idea plugin</span>
.idea_modules/

<span class="preprocessor"># JIRA plugin</span>
atlassian-ide-plugin.xml

<span class="preprocessor"># Crashlytics plugin (for Android Studio and IntelliJ)</span>
com_crashlytics_export_strings.xml


<span class="preprocessor"># [Maven] ========================</span>
target/
pom.xml.tag
pom.xml.releaseBackup
pom.xml.versionsBackup
pom.xml.next
release.properties


<span class="preprocessor"># [Gradle-Android] ========================</span>

<span class="preprocessor"># Ignore Gradle GUI config</span>
gradle-app.setting

<span class="preprocessor"># Gradle Signing</span>
signing.properties
trestle.keystore

<span class="preprocessor"># Mobile Tools for Java (J2ME)</span>
.mtj.tmp/

<span class="preprocessor"># Package Files #</span>
*.jar
*.war
*.ear

<span class="preprocessor"># virtual machine crash logs, see http://www.java.com/en/download/help/error_hotspot.xml</span>
hs_err_pid*

<span class="preprocessor"># Misc</span>
/.idea/workspace.xml
.DS_Store
/captures
**<span class="comment">/*.iml
*.class</span>
</code></pre><ul>
<li><p>修改项目根目录下的<strong>gradle.properties</strong></p>
<pre><code><span class="comment"># Project-wide Gradle settings.</span>

<span class="comment"># IDE (e.g. Android Studio) users:</span>
<span class="comment"># Gradle settings configured through the IDE *will override*</span>
<span class="comment"># any settings specified in this file.</span>

<span class="comment"># For more details on how to configure your build environment visit</span>
<span class="comment"># http://www.gradle.org/docs/current/userguide/build_environment.html</span>

<span class="comment"># Specifies the JVM arguments used for the daemon process.</span>
<span class="comment"># The setting is particularly useful for tweaking memory settings.</span>
<span class="comment"># Default value: -Xmx10248m -XX:MaxPermSize=256m</span>
<span class="comment"># org.gradle.jvmargs=-Xmx2048m -XX:MaxPermSize=512m -XX:+HeapDumpOnOutOfMemoryError -Dfile.encoding=UTF-8</span>

<span class="comment"># When configured, Gradle will run in incubating parallel mode.</span>
<span class="comment"># This option should only be used with decoupled projects. More details, visit</span>
<span class="comment"># http://www.gradle.org/docs/current/userguide/multi_project_builds.html#sec:decoupled_projects</span>
<span class="comment"># org.gradle.parallel=true</span>

<span class="setting">VERSION_NAME=<span class="value"><span class="number">0.0</span>.<span class="number">1</span></span></span>
<span class="setting">VERSION_CODE=<span class="value"><span class="number">1</span></span></span>
<span class="setting">GROUP=<span class="value">com.github.github_username</span></span>

<span class="setting">POM_DESCRIPTION=<span class="value">A library that does X, Y, and Z</span></span>
<span class="setting">POM_URL=<span class="value">https://github.com/github_username/ProjectName</span></span>
<span class="setting">POM_SCM_URL=<span class="value">https://github.com/github_username/ProjectName</span></span>
<span class="setting">POM_SCM_CONNECTION=<span class="value">scm:git@github.com:github_username/ProjectName.git</span></span>
<span class="setting">POM_SCM_DEV_CONNECTION=<span class="value">scm:git@github.com:github_username/ProjectName.git</span></span>
<span class="setting">POM_LICENCE_NAME=<span class="value">The Apache Software License, Version <span class="number">2.0</span></span></span>
<span class="setting">POM_LICENCE_URL=<span class="value">http://www.apache.org/licenses/LICENSE-<span class="number">2.0</span>.txt</span></span>
<span class="setting">POM_LICENCE_DIST=<span class="value">repo</span></span>
<span class="setting">POM_DEVELOPER_ID=<span class="value">github_username</span></span>
<span class="setting">POM_DEVELOPER_NAME=<span class="value">GitHub FullName</span></span>
</code></pre></li>
<li><p>添加一个<strong>README.md</strong>文件来告诉其他开发者你的library是干什么的以及他的用法，如果你需要添加截屏的话，我推荐你使用<a href="https://play.google.com/store/apps/details?id=de.toastcode.screener" target="_blank" rel="external">Screenr</a>生成截屏。</p>
</li>
</ul>
<h3 id="设置GPG">设置GPG</h3><p>如果你的电脑上没有安装GPG的话，那么你需要下载它，在MacOSX上，<a href="https://gist.github.com/IanVaughan/1932175" target="_blank" rel="external">下载命令</a></p>
<p>如果你从来没有使用过GPG，那么第一步是创建GPG keys:</p>
<pre><code>$ gpg <span class="comment">--gen-key</span>
</code></pre><p>如果你存在解决不了的问题，你可以参考<a href="https://kb.iu.edu/d/awio#key" target="_blank" rel="external">Creating an encryption key</a></p>
<p>接下来，你可以通过下面的命令找到你的key:</p>
<pre><code>$ gpg --<span class="keyword">list</span>-<span class="built_in">keys</span>
</code></pre><p>第一行看起来像XXXXX/YYYYYYY <date>,记住，’YYYYYYYY’部分，就是你的key ID。</date></p>
<p>现在，发布你的keys:</p>
<pre><code><span class="comment">$</span> <span class="comment">gpg</span> <span class="literal">-</span><span class="literal">-</span><span class="comment">keyserver</span> <span class="comment">hkp://keyserver</span><span class="string">.</span><span class="comment">ubuntu</span><span class="string">.</span><span class="comment">com</span> <span class="literal">-</span><span class="literal">-</span><span class="comment">send</span><span class="literal">-</span><span class="comment">keys</span> <span class="comment">YYYYYYYY</span>
<span class="comment">$</span> <span class="comment">gpg</span> <span class="literal">-</span><span class="literal">-</span><span class="comment">keyserver</span> <span class="comment">hkp://gpg</span><span class="string">.</span><span class="comment">mit</span><span class="string">.</span><span class="comment">edu</span> <span class="literal">-</span><span class="literal">-</span><span class="comment">send</span><span class="literal">-</span><span class="comment">keys</span> <span class="comment">YYYYYYYY</span>
</code></pre><p>你也可以使用其他的key服务器，你可能想确保你的keys是否已经发布：</p>
<pre><code>$ gpg --keyserver hkp:<span class="regexp">//pgp</span>.mit.edu --search-<span class="keyword">keys</span>
johndoe<span class="variable">@example</span>.com <span class="comment">#使用你的email</span>
</code></pre><p>你的库已经在<a href="http://gradleplease.appspot.com/" target="_blank" rel="external">Gradle,Please</a>中(别人可以轻松使用你的library)，上传你的project到<a href="http://search.maven.org/" target="_blank" rel="external">Maven Central</a>,最简单的方法就是通过<a href="http://central.sonatype.org/pages/ossrh-guide.html" target="_blank" rel="external">Sonatype</a></p>
<h3 id="Sonatype">Sonatype</h3><ol>
<li><p>在<a href="https://issues.sonatype.org/secure/Signup!default.jspa" target="_blank" rel="external">Sonatype</a>创建一个账号。</p>
</li>
<li><p>一旦登陆，创建一个<a href="https://issues.sonatype.org/secure/CreateIssue.jspa?issuetype=21&amp;pid=10134" target="_blank" rel="external">新的issue</a></p>
</li>
</ol>
<p><img src="https://d262ilb51hltx0.cloudfront.net/max/800/1*kV8pnaeikyXsgse0bWCeUA.png" alt="https://d262ilb51hltx0.cloudfront.net/max/800/1*kV8pnaeikyXsgse0bWCeUA.png"></p>
<p>我已经为我的项目创建一个GitHub协议，所以我在新的issue中填写的字段如下:</p>
<p><strong>Group id</strong>:com.github.<github_username></github_username></p>
<p><strong>Project URL</strong>:<a href="https://github.com/" target="_blank" rel="external">https://github.com/</a><github_username>/<project_name></project_name></github_username></p>
<p><strong>SCM url</strong>: <a href="https://github.com/" target="_blank" rel="external">https://github.com/</a><github_username>/<project_name>.git</project_name></github_username></p>
<p><strong>Username</strong>:<sonatype_username></sonatype_username></p>
<p><strong>Already Synced to Central</strong>:No</p>
<p>注意:那些括号只是占位符，你需要用适当的值替换</p>
<p>当你提交issue的时候，issue的细节就相当于上面的截图，提交之后，会花费两天处理你的issue，你将会收到一个关于你的配置已经准备好，你的库可以发布的确认信息。</p>
<p>不要部署直到你收到一封邮件证明你的问题已解决，</p>
<p>如果你的项目已经在中央仓库，那么就需要确保如何迁移到OSSRH。</p>
<p>修改你本地机器上的 ～/.gradle/gradle.properties:</p>
<pre><code>NEXUS_USERNAME=sonatype_username
NEXUS_PASSWORD=sonatype_password

signing.keyId=gpg_key_id 
signing.password=gpg_password
signing.secretKeyRingFile=/Users/username/.gnupg/secring<span class="class">.gpg</span>
org<span class="class">.gradle</span><span class="class">.daemon</span>=true
</code></pre><p>当你发布这个库时是通过gradle.properties来验证的，所以确保你提供正确的nexus用户名和密码(这里是Sonatype的用户名和密码)，否则你会得到一个未经授权的401错误。</p>
<p>注意：如果你已经发布你的库了没那么你就不需要在JIRA上创建新的issue，因为对一每一个顶级的groupId来说只用创建一个JIRA，你现在已经有权限向你的groupId或者任何sub-groups部署新的工作(此处省略一部分，尼玛，太不好翻译了!!!)</p>
<h3 id="发布">发布</h3><p>一旦你已经准备好发布你的library，打开Android Studio右边的Gradle视图，在<strong>Tasks &gt; upload</strong>点击<strong>UploadArchives</strong>,将会上传你的库到<a href="https://oss.sonatype.org/#stagingRepositories" target="_blank" rel="external">Sonatype Staging Repositories</a>;</p>
<p>去<a href="https://oss.sonatype.org/#stagingRepositories" target="_blank" rel="external">Sonatype Staging Repositories</a>确保你的<strong>Sonatype</strong>账号已经登陆，寻找你的暂存的库，他应该在列表的最后，选中他，然后点击close按钮，关闭意味着你准备发布，如果close操作成功，你将会看到一个Release按钮被激活，你需要刷新页面，点击release按钮，参照<a href="https://books.sonatype.com/nexus-book/reference/staging-repositories.html" target="_blank" rel="external">帮助文档</a>，如果你的库已经发布，那么你就可以返回JIRA然后发布评论来提升你的库，之后你会收到一个Sonatype的一个回应，几分钟之后你的库就可用了，然后几个小时之后就会被同步到Maven中央，再过几个小事就会显示在Gradle中。</p>
</span>
        
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <header class="post-header">

      
      
        <h1 class="post-title" itemprop="name headline">
          
          
            
              <a class="post-title-link" href="/2015/11/04/实现RecyclerView的下拉刷新和上拉加载更多/" itemprop="url">
                实现RecyclerView的下拉刷新和上拉加载更多
              </a>
            
          
        </h1>
      

      <div class="post-meta">
        <span class="post-time">
          發表於
          <time itemprop="dateCreated" datetime="2015-11-04T16:28:14+08:00" content="2015-11-04">
            2015-11-04
          </time>
        </span>

        

        
          
            <span class="post-comments-count">
              &nbsp; | &nbsp;
              <a href="/2015/11/04/实现RecyclerView的下拉刷新和上拉加载更多/#comments" itemprop="discussionUrl">
                <span class="post-comments-count ds-thread-count" data-thread-key="2015/11/04/实现RecyclerView的下拉刷新和上拉加载更多/" itemprop="commentsCount"></span>
              </a>
            </span>
          
        
      </div>
    </header>

    <div class="post-body">

      
      

      
        
          <span itemprop="articleBody"><p>这两天项目中牵涉了对于RecyclerView的上拉加载更多和下拉刷新的功能，所以总结一下:</p>
<p>我们的下拉刷新使用的是<strong>android.support.v4.widget.SwipeRefreshLayout</strong>,而上拉加载更多使用的方案是通过给RecyclerView添加<strong>footerview</strong>来实现的。</p>
<p>所以代码是这样的:</p>
<pre><code>mSwipeRefreshLayout.setOnRefreshListener(<span class="keyword">this</span>);

<span class="annotation">@Override</span>
<span class="keyword">public</span> <span class="function"><span class="keyword">void</span> <span class="title">onRefresh</span><span class="params">()</span></span>{
    <span class="comment">//在这里执行下拉刷新的功能</span>
}

<span class="comment">//以下是上拉加载更多的方法</span>
<span class="keyword">int</span> lastVisibleItem<span class="comment">//最后一条可见的item</span>
mRvMessage.addOnScrollListener(<span class="keyword">new</span> RecyclerView.OnScrollListener() {
            <span class="annotation">@Override</span>
            <span class="keyword">public</span> <span class="function"><span class="keyword">void</span> <span class="title">onScrollStateChanged</span><span class="params">(RecyclerView recyclerView, <span class="keyword">int</span> newState)</span> </span>{
                <span class="keyword">super</span>.onScrollStateChanged(recyclerView, newState);
                <span class="keyword">int</span> totalCount = mLinearLayoutManager.getItemCount();<span class="comment">//RecyclerView中的总的条目的数量(此处代表的是可见的和不可见的总数)</span>
                <span class="keyword">if</span>(newState == RecyclerView.SCROLL_STATE_IDLE &amp;&amp; lastVisibleItem + <span class="number">1</span>==totalCount){
                        <span class="comment">//此处添加加载更多的代码，一般为取数据库或者加载网络等</span>
                }
            }

            <span class="annotation">@Override</span>
            <span class="keyword">public</span> <span class="function"><span class="keyword">void</span> <span class="title">onScrolled</span><span class="params">(RecyclerView recyclerView, <span class="keyword">int</span> dx, <span class="keyword">int</span> dy)</span> </span>{
                <span class="keyword">super</span>.onScrolled(recyclerView, dx, dy);
                <span class="comment">//每次滑动的时候要更新最后一条可见的item的id</span>
                lastVisibleItem = mLinearLayoutManager.findLastVisibleItemPosition();
            }
        });
</code></pre></span>
        
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <header class="post-header">

      
      
        <h1 class="post-title" itemprop="name headline">
          
          
            
              <a class="post-title-link" href="/2015/10/29/解决软键盘和dialog一同消失的问题/" itemprop="url">
                解决软键盘和dialog一同消失的问题
              </a>
            
          
        </h1>
      

      <div class="post-meta">
        <span class="post-time">
          發表於
          <time itemprop="dateCreated" datetime="2015-10-29T16:18:45+08:00" content="2015-10-29">
            2015-10-29
          </time>
        </span>

        

        
          
            <span class="post-comments-count">
              &nbsp; | &nbsp;
              <a href="/2015/10/29/解决软键盘和dialog一同消失的问题/#comments" itemprop="discussionUrl">
                <span class="post-comments-count ds-thread-count" data-thread-key="2015/10/29/解决软键盘和dialog一同消失的问题/" itemprop="commentsCount"></span>
              </a>
            </span>
          
        
      </div>
    </header>

    <div class="post-body">

      
      

      
        
          <span itemprop="articleBody"><h3 id="前言">前言</h3><p>最近在做一个关于分享经验贴的一个App，其中文章详情界面出现了一个问题就是在界面的最下面有一条操作栏，其中有一项就是一个小的输入框,点击小的输入框，界面样式如下：</p>
<p><img src="https://github.com/zhanfangzxc/zhanfangzxc.github.io/blob/source/source/_posts/bottom.png?raw=true" alt="图一"></p>
<p>点击左侧的写评论的输入框，会出现如下界面:</p>
<p><img src="https://github.com/zhanfangzxc/zhanfangzxc.github.io/blob/source/source/_posts/open.png?raw=true" alt="图二"></p>
<p>这个界面是从底部弹出的一个Dialog，也可以用<a href="http://www.javabeat.net/dialog-activity-android/" target="_blank" rel="external">透明的Activity实现</a>,我这里使用的是github上的一个<a href="https://github.com/H07000223/FlycoDialog_Master" target="_blank" rel="external">开源的Dialog库</a>，因为动画设置，以及界面设置都比较方便，所以就用了这个，但是示例中没有我的这个应用场景，基本上就是一些条目点击选择的示例.</p>
<h3 id="问题描述">问题描述</h3><p>但是我们的项目中存在的问题就是当点击弹出Dialog的时候，要同时弹出软键盘，当点击返回键和或点击除Dialog的其他地方的时候，让Dialog和软件盘同时消失，就因为这个事搞了一天，最后还是借助别人的帮助实现的，但是还是想发出来供以后遇到该问题的朋友参考:</p>
<h3 id="解决方案">解决方案</h3><p>以下是解决方案，<strong>是通过计算弹出软键盘之前和之后的高度变化，来实现关闭Dialog的</strong>，在你创建的Dialog文件的<strong>OnCreateView()</strong>方法中添加如下代码:</p>
<pre><code><span class="comment">//监听视图树的布局变化</span>
view.getViewTreeObserver().addOnGlobalLayoutListener(<span class="keyword">new</span> ViewTreeObserver.OnGlobalLayoutListener() {
            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onGlobalLayout</span><span class="params">()</span> </span>{

                <span class="keyword">int</span>[] locations = <span class="keyword">new</span> <span class="keyword">int</span>[<span class="number">2</span>];

                <span class="comment">//计算该视图在全局坐标系中的x、y值，这个值是从屏幕顶端算起的，包括了通知栏的高度；得到的是当前屏幕内的绝对坐标</span>
                view.getLocationOnScreen(locations);
                <span class="keyword">int</span> y = locations[<span class="number">1</span>];
                <span class="keyword">if</span> (oldY != <span class="number">0</span> &amp;&amp; oldY &lt; y) {
                    <span class="comment">//从小变大 说明关闭了输入法</span>
                    Logger.d(<span class="string">"y的值是:"</span> + y + <span class="string">"oldY的值是:"</span> + oldY);
                    hide();
                }
                oldY = y;
            }
        });

        <span class="comment">//dialog的cancel事件的监听方法</span>

        setOnCancelListener(<span class="keyword">new</span> OnCancelListener() {
            @<span class="function">Override
            <span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onCancel</span><span class="params">(DialogInterface dialog)</span> </span>{
                imm.hideSoftInputFromWindow(mEtComment.getWindowToken(), <span class="number">0</span>);
            }
        });

        <span class="comment">//dialog的show事件的监听方法</span>

        setOnShowListener(<span class="keyword">new</span> OnShowListener() {
            @<span class="function">Override
            <span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onShow</span><span class="params">(DialogInterface dialog)</span> </span>{
                imm.toggleSoftInput(InputMethodManager.SHOW_FORCED, <span class="number">0</span>);
            }
        });
</code></pre><h3 id="总结">总结</h3><p>还有一点值得注意的就是在点击事件中<strong>showDialog</strong>的时候，一定要创建和show写在一起，如果将创建Dialog写在Activity中<strong>onCreate</strong>方法中，在点击事件中写<strong>show</strong>的话，就会存在，键盘第一次出现，可是当点击返回键让Dialog消失了之后，再点击让他显示的时候，就只会显示Dialog，不会显示软键盘，尽管我在Dialog的文件中写了show的监听事件，但是还是没什么效果，很是郁闷，希望找到解决方案的同学可以告知我。</p>
</span>
        
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <header class="post-header">

      
      
        <h1 class="post-title" itemprop="name headline">
          
          
            
              <a class="post-title-link" href="/2015/10/23/优秀文章整理/" itemprop="url">
                优秀文章整理
              </a>
            
          
        </h1>
      

      <div class="post-meta">
        <span class="post-time">
          發表於
          <time itemprop="dateCreated" datetime="2015-10-23T16:54:03+08:00" content="2015-10-23">
            2015-10-23
          </time>
        </span>

        

        
          
            <span class="post-comments-count">
              &nbsp; | &nbsp;
              <a href="/2015/10/23/优秀文章整理/#comments" itemprop="discussionUrl">
                <span class="post-comments-count ds-thread-count" data-thread-key="2015/10/23/优秀文章整理/" itemprop="commentsCount"></span>
              </a>
            </span>
          
        
      </div>
    </header>

    <div class="post-body">

      
      

      
        
          <span itemprop="articleBody"><h3 id="Handler相关">Handler相关</h3><p><strong>Handler消息机制</strong>:<a href="http://codecloud.net/android-handler-6351.html" target="_blank" rel="external">http://codecloud.net/android-handler-6351.html</a></p>
<h3 id="Handler消息机制简介">Handler消息机制简介</h3><ul>
<li>Handler 处理消息；发送消息，并将消息压入栈中</li>
<li>Lopper  通过loop()函数中的死循环，不断的从MessageQueue中取出Message，然后传给Handler进行处理。</li>
<li>MessageQueue 消息队列，用来存储Runnable、Message</li>
</ul>
<h3 id="为什么在主线程中能够直接创建Handler">为什么在主线程中能够直接创建Handler</h3><p>在ActivityThread.class的<strong>main()</strong>函数中，能够看到如下两句代码：</p>
<pre><code><span class="tag">Lopper</span><span class="class">.prepareMainLopper</span>();

<span class="tag">Lopper</span><span class="class">.loop</span>();
</code></pre><h3 id="在子线程创建Handler的步骤">在子线程创建Handler的步骤</h3><ol>
<li>Lopper.prepare();</li>
<li>实例化Handler，在构造方法中实现handleMessage(Message msg)处理消息;</li>
<li>Lopper.loop();</li>
</ol>
<p>第一步源码：</p>
<pre><code><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Lopper</span></span>{
    ...
    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> ThreadLocal sThreadLocal = <span class="keyword">new</span> ThreadLocal();

    <span class="keyword">final</span> MessageQueue mQueue;

    ......

    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">void</span> <span class="title">prepare</span><span class="params">()</span></span>{
        <span class="keyword">if</span>(sThreadLocal.get() != <span class="keyword">null</span>){
            <span class="keyword">throw</span> <span class="keyword">new</span> RuntimeException(<span class="string">"Only one Lopper may be created per thread"</span>);
        }
        <span class="comment">//创建一个Looper对象，并绑定到ThreadLocal中</span>
        <span class="comment">//为了保证每一个调用prepare()函数的线程里面都有一个唯一的Looper对象</span>
        <span class="comment">//在创建Looper的同时也创建了一个MessageQueue对象</span>
        sThreadLocal.set(<span class="keyword">new</span> Lopper());
    }

    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">void</span> <span class="title">prepareMainLopper</span><span class="params">()</span></span>{
        prepare();
        setMainLooper(myLooper());
        <span class="keyword">if</span>(Process.supportProcesses()){
            myLooper().mQueue.mQuitAllowed = <span class="keyword">false</span>;
        }
    }

    <span class="function"><span class="keyword">private</span> <span class="keyword">synchronized</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">setMainLooper</span><span class="params">(Looper looper)</span></span>{
        sMainLooper = Looper;
    }

    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> Looper <span class="title">myLooper</span><span class="params">()</span></span>{
        <span class="keyword">return</span> (Looper)sThreadLocal.get();
    }

    <span class="function"><span class="keyword">private</span> <span class="title">Looper</span><span class="params">()</span></span>{
        mQueue = <span class="keyword">new</span> MessageQueue();
        mRun = <span class="keyword">true</span>;
        mThread = Thread.currentThread();
    }
}
</code></pre><p>第二步：创建Handler实例</p>
<pre><code>Handler <span class="keyword">handler</span> = <span class="keyword">new</span> Handler(){
    <span class="keyword">public</span> <span class="function"><span class="keyword">void</span> <span class="title">handleMessage</span><span class="params">(Message msg)</span></span>{
        <span class="comment">//处理消息逻辑</span>
    }
};

<span class="comment">//Handler的构造函数</span>
<span class="function"><span class="keyword">public</span> <span class="title">Handler</span><span class="params">()</span></span>;
<span class="function"><span class="keyword">public</span> <span class="title">Handler</span><span class="params">(Callback callback)</span></span>;
<span class="function"><span class="keyword">public</span> <span class="title">Handler</span><span class="params">(Looper looper)</span></span>;
<span class="function"><span class="keyword">public</span> <span class="title">Handler</span><span class="params">(Looper looper,Callback callback)</span></span>;

<span class="comment">//源码</span>

<span class="function"><span class="keyword">public</span> <span class="title">Handler</span><span class="params">(Callback callback,<span class="keyword">boolean</span> async)</span></span>{
    mLooper = Looper.myLooper();
    <span class="keyword">if</span>(myLooper == <span class="keyword">null</span>){
        <span class="keyword">throw</span> <span class="keyword">new</span> RuntimeException(<span class="string">"XXX"</span>);
    }
    mQueue = mLooper.mQueue;
    mCallback = callback;
    mAsynchronous = async;
}
</code></pre><blockquote>
<p>在创建Handler之前必须先有一个Looper，在创建Looper的同时会创建一个MessageQueue对象，所以在Handler的构造函数中能够同时获取Looper和MessageQueue这两个对象。</p>
</blockquote>
<p>第三步Lopper.loop()的源码：</p>
<pre><code><span class="keyword">public</span> <span class="keyword">static</span> <span class="function"><span class="keyword">void</span> <span class="title">loop</span><span class="params">()</span></span>{
    <span class="keyword">final</span> Looper me = myLooper();
    <span class="keyword">final</span> MessageQueue queue = me.mQueue;

    <span class="keyword">for</span>(;;){
        Message msg = queue.next();
        <span class="keyword">if</span>(msg == <span class="keyword">null</span>){
            <span class="keyword">return</span>;
        }
        ...
        <span class="comment">//关键代码</span>
        msg.<span class="keyword">target</span>.dispatchMessage(msg);
    }
}
</code></pre><p>接下来看<strong>dispatch(msg)</strong>方法的源码</p>
<pre><code><span class="keyword">public</span> <span class="function"><span class="keyword">void</span> <span class="title">dispatchMessage</span><span class="params">(Message msg)</span></span>{
    <span class="keyword">if</span>(msg.callback != <span class="keyword">null</span>){
        handleCallback(msg);
    }<span class="keyword">else</span>{
        <span class="keyword">if</span>(mCallback != <span class="keyword">null</span>){
            <span class="keyword">if</span>(mCallback.handleMessage(msg)){
                <span class="keyword">return</span>;
            }
        }
        <span class="comment">//这个即是我们每次创建Handler的时候需要实现的方法</span>
        handleMessage(msg);
    }
}
</code></pre><h3 id="发送消息">发送消息</h3><blockquote>
<p>我们一般发送消息通过sendMessage(msg),下面是发送消息的源码：</p>
</blockquote>
<pre><code><span class="keyword">public</span> <span class="function"><span class="keyword">boolean</span> <span class="title">sendMessageAtTime</span><span class="params">(Message msg,<span class="keyword">long</span> uptimeMillis)</span></span>{
    MessageQueue queue = mQueue;
    <span class="keyword">if</span>(queue == <span class="keyword">null</span>){
        RuntimeException e = <span class="keyword">new</span> RuntimeException(<span class="string">"XXX"</span>);
        <span class="keyword">return</span> <span class="keyword">false</span>;
    }
    <span class="comment">//将Message压入MessageQueue中</span>
    <span class="function"><span class="keyword">return</span> <span class="title">enqueueMessage</span><span class="params">(queue,mag,uptimeMillis)</span></span>;
}
</code></pre></span>
        
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <header class="post-header">

      
      
        <h1 class="post-title" itemprop="name headline">
          
          
            
              <a class="post-title-link" href="/2015/10/12/Retrofit2-更新指南/" itemprop="url">
                Retrofit2 更新指南
              </a>
            
          
        </h1>
      

      <div class="post-meta">
        <span class="post-time">
          發表於
          <time itemprop="dateCreated" datetime="2015-10-12T09:39:49+08:00" content="2015-10-12">
            2015-10-12
          </time>
        </span>

        
          <span class="post-category" >
            &nbsp; | &nbsp; 分類於
            
              <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                <a href="/categories/Android/" itemprop="url" rel="index">
                  <span itemprop="name">Android</span>
                </a>
              </span>

              
              

            
          </span>
        

        
          
            <span class="post-comments-count">
              &nbsp; | &nbsp;
              <a href="/2015/10/12/Retrofit2-更新指南/#comments" itemprop="discussionUrl">
                <span class="post-comments-count ds-thread-count" data-thread-key="2015/10/12/Retrofit2-更新指南/" itemprop="commentsCount"></span>
              </a>
            </span>
          
        
      </div>
    </header>

    <div class="post-body">

      
      

      
        
          <span itemprop="articleBody"><p>原文链接:<a href="https://futurestud.io/blog/retrofit-2-upgrade-guide-from-1-9/" target="_blank" rel="external">https://futurestud.io/blog/retrofit-2-upgrade-guide-from-1-9/</a></p>
<h3 id="Retrofit概述">Retrofit概述</h3><ol>
<li><a href="https://futurestud.io/blog/retrofit-getting-started-and-android-client/" target="_blank" rel="external">Getting Started and Create an Android Client</a></li>
<li><a href="https://futurestud.io/blog/android-basic-authentication-with-retrofit/" target="_blank" rel="external">Basic Authentication with Retrofit</a></li>
<li><a href="https://futurestud.io/blog/oauth-2-on-android-with-retrofit/" target="_blank" rel="external">OAuth with Retrofit</a></li>
<li><a href="https://futurestud.io/blog/retrofit-token-authentication-on-android/" target="_blank" rel="external">Token Authentication with Retrofit</a></li>
<li><a href="https://futurestud.io/blog/retrofit-synchronous-and-asynchronous-requests/" target="_blank" rel="external">Synchronous and Aynchronous Request Execution with Retrofit</a></li>
<li><a href="https://futurestud.io/blog/retrofit-multiple-query-parameters-of-same-name/" target="_blank" rel="external">Multiple Query Parameters of Same Name</a></li>
<li><a href="https://futurestud.io/blog/retrofit-send-objects-in-request-body/" target="_blank" rel="external">Send Objects in Request Body with Retrofit</a></li>
<li><a href="https://futurestud.io/blog/retrofit-replace-the-integrated-json-converter/" target="_blank" rel="external">Define Custom JSON Converter</a></li>
<li><a href="https://futurestud.io/blog/retrofit-add-custom-request-header/" target="_blank" rel="external">Add Custom HTTP Request Headers</a></li>
<li><a href="https://futurestud.io/blog/retrofit-add-custom-request-header/" target="_blank" rel="external">Optional Query Parameters</a></li>
<li><a href="https://futurestud.io/blog/retrofit-how-to-integrate-xml-converter/" target="_blank" rel="external">XML Converter with Retrofit</a></li>
<li><a href="https://futurestud.io/blog/retrofit-using-the-log-level-to-debug-requests/" target="_blank" rel="external">Debugging Requests with Retrofit’s Log Level</a></li>
<li><a href="https://futurestud.io/blog/retrofit-how-to-upload-files/" target="_blank" rel="external">File Upload with Retrofit</a></li>
<li><a href="https://futurestud.io/blog/retrofit-series-round-up/" target="_blank" rel="external">Round-Up Retrofit Series</a></li>
<li><a href="https://futurestud.io/blog/retrofit-2-upgrade-guide-from-1-9/" target="_blank" rel="external">Retrofit Upgrade Guide: 1.9 to 2.0</a></li>
</ol>
<h3 id="添加Gradle依赖项">添加Gradle依赖项</h3><pre><code><span class="keyword">compile</span> <span class="string">'com.squareup.retrofit:retrofit:2.0.0-beta2'</span>
<span class="keyword">compile</span> <span class="string">'com.square.okhttp:okhttp:2.5.0'</span>
</code></pre><p>Retrofit 2默认情况下不集成Gson，在之前，你不用去考虑转换器的集成问题，现在的变化需要你导入你需要的转换器开源库，接下来将会给你展示如何配置Gson或其他的转换器。</p>
<h3 id="转换器">转换器</h3><pre><code><span class="title">comile</span> <span class="string">'com.squareup.retrofit:converter-gson:2.0.0-beta2'</span>
</code></pre><p>默认情况戏Rxjava也不会引入，所以你需要手动的添加Rxjava的依赖项</p>
<pre><code><span class="keyword">compile</span> <span class="string">'com.squareup.retrofit:adapter-rxjava:2.0.0-beta2'</span>
<span class="keyword">compile</span> <span class="string">'io.reativex:rxandroid:1.0.1'</span>
</code></pre><h3 id="RestAdapter_-&gt;_Retrofit">RestAdapter -&gt; Retrofit</h3><p>之前的<strong>RestAdapter</strong>重新命名为<strong>Retrofit</strong></p>
<p><strong>Retrofit 1.9</strong></p>
<pre><code>RestAdapter.Builder builder = <span class="keyword">new</span> RestAdapter.Builder();
</code></pre><p><strong>Retrofit 2.0</strong></p>
<pre><code>Retrofit.Builder builder = <span class="keyword">new</span> Retrofit.Builder();
</code></pre><h3 id="setEndPoint_-&gt;_baseUrl">setEndPoint -&gt; baseUrl</h3><p><strong>setEndPoint</strong>方法变成了<strong>baseUrl</strong></p>
<p><strong>Retrofit 1.9</strong></p>
<pre><code><span class="label">RestAdapter.Builder</span> <span class="keyword">builder </span>= new RestAdapter.<span class="keyword">Builder()
</span>    .<span class="keyword">setEndpoint(API_BASE_URL)
</span>    .<span class="keyword">build();
</span>
<span class="label">YourService</span> service = adapter.create(YourService.class)<span class="comment">;</span>
</code></pre><p><strong>Retrofit 2.0</strong></p>
<pre><code><span class="label">Retrofit.Builder</span> <span class="keyword">builder </span>= new Retrofit.<span class="keyword">Builder()
</span>    .<span class="keyword">baseUrl(API_BASE_URL)
</span>    .<span class="keyword">build();
</span>
<span class="label">YourService</span> service = retrofit.create(YourService.class)<span class="comment">;</span>
</code></pre><h3 id="Base_Url_处理">Base Url 处理</h3><p>在之前的版本，定义的endpoint会作为默认的请求url，你自己定义的那部分包括查询或路径参数，请求体或multiparts，所以最后的请求url是endpoint url和自己定义的那部分url的结合：</p>
<p><strong>Retrofit 1.x</strong></p>
<pre><code><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">UserService</span>{</span>
    <span class="annotation">@POST</span>(<span class="string">"me"</span>)
    User me();
}

RestAdapter adapter = RestAdapter.Builder()
    .baseUrl(<span class="string">"http://your.api.url/v2/"</span>);
    .build();

UserService service = adapter.create(UserService.<span class="keyword">class</span>);

<span class="comment">//所以对于service.me()方法的请求url就是：</span>
<span class="comment">//Https://your.api.url/v2/me</span>
</code></pre><p><strong>Retrofit 2.x</strong></p>
<pre><code><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">UserService</span>(){</span>
    <span class="annotation">@POST</span>(<span class="string">"/me"</span>)
    User me();
}

Retrofit retrofit = Retrofit.Builder()
    .baseUrl(<span class="string">"https://your.api.url/v2"</span>);
    .build();

UserService service = retrofit.create(UserService.<span class="keyword">class</span>);

<span class="comment">// 最终service.me()方法的请求url是：</span>
<span class="comment">// http://your.api.url/me</span>
</code></pre><p>第二种样子</p>
<pre><code><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">UserService</span> </span>{  
    <span class="annotation">@POST</span>(<span class="string">"me"</span>)
    <span class="function">User <span class="title">me</span><span class="params">()</span></span>;
}

Retrofit retrofit = Retrofit.Builder()  
    .baseUrl(<span class="string">"https://your.api.url/v2/"</span>);
    .build();

UserService service = retrofit.create(UserService.cass);

<span class="comment">// the request url for service.me() is: </span>
<span class="comment">// https://your.api.url/v2/me</span>
</code></pre><h3 id="动态Url">动态Url</h3><pre><code><span class="tag">public</span> <span class="tag">interface</span> <span class="tag">UserService</span>{
    <span class="variable">@GET</span>
    public Call&lt;File&gt; <span class="function">getZipFile</span>(<span class="variable">@Url</span> String url);
}
</code></pre><h3 id="OkHttp请求">OkHttp请求</h3><pre><code><span class="keyword">compile</span> <span class="string">'com.squareup.okhttp:okhttp:2.5.0'</span>
</code></pre><h3 id="OkHttp拦截器">OkHttp拦截器</h3><pre><code><span class="type">OkHttpClient</span> client = new <span class="type">OkHttpClient</span>();  
client.interceptors().add(new <span class="type">Interceptor</span>() {  
    @<span class="type">Override</span>
    public <span class="type">Response</span> intercept(<span class="type">Chain</span> chain) throws <span class="type">IOException</span> {
        <span class="type">Request</span> original = chain.request();

        // <span class="type">Customize</span> the request 
        <span class="type">Request</span> request = original.newBuilder()
                .header(<span class="string">"Accept"</span>, <span class="string">"application/json"</span>)
                .header(<span class="string">"Authorization"</span>, <span class="string">"auth-token"</span>)
                .<span class="keyword">method</span>(original.<span class="keyword">method</span>(), original.body())
                .build();

        <span class="type">Response</span> response = chain.proceed(request);

        // <span class="type">Customize</span> <span class="keyword">or</span> <span class="keyword">return</span> the response 
        <span class="keyword">return</span> response;
    }
});

<span class="type">Retrofit</span> retrofit = <span class="type">Retrofit</span>.<span class="type">Builder</span>()  
    .baseUrl(<span class="string">"https://your.api.url/v2/"</span>);
    .client(client)
    .build();
</code></pre><p>如果你要使用自定义的OkHttpClient，你必须要设置在<strong>Retrofit.Builder</strong>中设置Client通过<strong>.client()</strong>方法，这将会更新默认的Client。</p>
<h3 id="同步和异步请求">同步和异步请求</h3><p>同步方法需要一个返回类型，异步方法需要一个Callback作为最后一个参数</p>
<p>在Retrofit 2中，同步和异步将没有什么区别，请求现在包裹成一个通用的类使用所需的响应类型。下面的内容将为你讲述Retrofit 1和Retrofit 2在service声明和请求执行方面的区别。</p>
<h3 id="Interface_声明">Interface 声明</h3><p>同步和异步请求的区别，你定义任何实际类型或者<strong>Void</strong>作为返回类型，异步需要你定义一个通用的回调作为最后一个方法参数，，下面的代码展示了一个Retrofit 1的声明方法：</p>
<p><strong>Retrofit 1.9</strong></p>
<pre><code><span class="tag">public</span> <span class="tag">interface</span> <span class="tag">UserService</span> {  
    <span class="comment">// Synchronous Request</span>
    <span class="variable">@POST</span>(<span class="string">"/login"</span>)
    User <span class="function">login</span>();

    <span class="comment">// Asynchronous Request</span>
    <span class="variable">@POST</span>(<span class="string">"/login"</span>)
    void <span class="function">getUser</span>(<span class="variable">@Query</span> String id, Callback&lt;User&gt; cb);
}
</code></pre><p><strong>Retrofit 2.x</strong></p>
<pre><code><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">UserService</span> </span>{  
    <span class="annotation">@POST</span>(<span class="string">"/login"</span>)
    <span class="function">Call&lt;User&gt; <span class="title">login</span><span class="params">()</span></span>;
}
</code></pre><h3 id="请求执行">请求执行</h3><p><strong>Retrofit 1.9</strong></p>
<pre><code><span class="comment">// synchronous</span>
User user = userService.login();

<span class="comment">// asynchronous</span>
userService.login(<span class="keyword">new</span> Callback&lt;User&gt;() {  
<span class="annotation">@Override</span>
    <span class="keyword">public</span> <span class="function"><span class="keyword">void</span> <span class="title">success</span><span class="params">(User user, Response response)</span> </span>{
        <span class="comment">// handle response</span>
    }

    <span class="annotation">@Override</span>
    <span class="keyword">public</span> <span class="function"><span class="keyword">void</span> <span class="title">failure</span><span class="params">(RetrofitError <span class="keyword">error</span>)</span> </span>{
        <span class="comment">// handle error</span>
    }
});
</code></pre><p>Retrofit 1和Retrofit 2的请求完全不同，在2中所有的请求都会包裹在一个<strong>Call</strong>对象中，你可以通过<strong>call.execute()</strong>执行同步请求，通过<strong>call.enqueue(new Callback&lt;&gt;())</strong>来执行异步请求，下面是示例代码：</p>
<pre><code><span class="comment">// synchronous</span>
<span class="keyword">Call</span>&lt;User&gt; <span class="keyword">call</span> = userService.login();  
User user = <span class="keyword">call</span>.execute();

<span class="comment">// asynchronous</span>
<span class="keyword">Call</span>&lt;User&gt; <span class="keyword">call</span> = userService.login();  
<span class="keyword">call</span>.enqueue(<span class="keyword">new</span> Callback&lt;User&gt;() {  
    @Override
    <span class="keyword">public</span> <span class="keyword">void</span> onResponse(Response&lt;User&gt; response, Retrofit retrofit) {
        <span class="comment">// response.isSuccess() is true if the response code is 2xx</span>
        <span class="keyword">if</span> (response.isSuccess()) {
            User user = response.body();
        } <span class="keyword">else</span> {
            <span class="keyword">int</span> statusCode = response.code();

            <span class="comment">// handle request errors yourself</span>
            ResponseBody errorBody = response.errorBody();
        }
    }

    @Override
    <span class="keyword">public</span> <span class="keyword">void</span> onFailure(Throwable t) {
        <span class="comment">// handle execution failures like no internet connectivity </span>
    }
}
</code></pre><p>在Retrofit 2中即使请求不成功也会调用<strong>onResponse()</strong>.<strong>Response</strong>类有一个<strong>isSuccess()</strong>方法用来检查是否处理成功(返回<strong>2xx</strong>的状态码)，你可以利用响应对象来做进一步的处理，如果状态码不是2xx，你需要自行处理错误，如果你希望在失败的情况下得到一个响应体，那么你就需要通过<strong>ResponseBody</strong>类中的<strong>errorBody()</strong>方法来转换对象。</p>
<blockquote>
<p>同步请求在Android上可能会导致应用程序崩溃在Android 4.0 +。使用异步请求来避免阻塞会导致应用程序的主UI线程失败。</p>
</blockquote>
<h3 id="取消请求">取消请求</h3><p>在Retrofit 1中没有提供取消请求的方法，在Retrofit 2中如果http调度程序没有执行他的时候，你可以取消任何请求。</p>
<pre><code><span class="operator"><span class="keyword">Call</span>&lt;<span class="keyword">User</span>&gt; <span class="keyword">call</span> = userService.login();</span>
User user = <span class="operator"><span class="keyword">call</span>.<span class="keyword">execute</span>();</span>

<span class="operator"><span class="keyword">call</span>.<span class="keyword">cancel</span>();</span>
</code></pre><h3 id="没有默认的转换器">没有默认的转换器</h3><p>在之前的1的版本中默认有Gson做为json的转换器，在2的版本中没有默认的转换器，你需要自己定义转换器，如果你想使用Gson，就必须要在gradle添加Gson的依赖项：</p>
<pre><code><span class="keyword">compile</span> <span class="string">'com.squareup.retrofit:converter-gson:2.0.0-beta2'</span>  
</code></pre><p><strong>可用的转换器</strong></p>
<ul>
<li>GSON: com.squareup.retrofit:converter-gson:2.0.0-beta2</li>
<li>Moshi: com.squareup.retrofit:converter-moshi:2.0.0-beta2</li>
<li>Jackson: com.squareup.retrofit:converter-jackson:2.0.0-beta2</li>
<li>SimpleXML: com.squareup.retrofit:converter-simplexml:2.0.0-beta2</li>
<li>ProtoBuf: com.squareup.retrofit:converter-protobuf:2.0.0-beta2</li>
<li>Wire: com.squareup.retrofit:converter-wire:2.0.0-beta2</li>
</ul>
<h3 id="给Retrofit添加转换器">给Retrofit添加转换器</h3><pre><code><span class="type">Retrofit</span> retrofit = <span class="type">Retrofit</span>.<span class="type">Builder</span><span class="literal">()</span>  
    .baseUrl(<span class="string">"https://your.api.url/v2/"</span>);
    .addConverterFactory(<span class="type">ProtoConverterFactory</span>.create<span class="literal">()</span>)
    .addConverterFactory(<span class="type">GsonConverterFactory</span>.create<span class="literal">()</span>)
    .build<span class="literal">()</span>;
</code></pre><h3 id="Rxjava_集成">Rxjava 集成</h3><p>Retrofit 1中集成了三中请求执行机制：同步，异步和Rxjava；在Retrofit 2中默认的只有同步和异步的请求，但是Retrofit提供了一个添加其他请求执行机制进Retrofit中的方法，你可以添加更多的机制在你的app中，比如说Rxjava</p>
<p><strong>Gradle 依赖</strong></p>
<pre><code><span class="keyword">compile</span> <span class="string">'com.squareup.retrofit:adapter-rxjava:2.0.0-beta2'</span>  
<span class="keyword">compile</span> <span class="string">'io.reactivex:rxandroid:1.0.1'</span>  
</code></pre><p>接下来需要在创建service实例之前添加一个<strong>CallAdapter</strong>进<strong>Retrofit</strong>对象</p>
<pre><code><span class="label">Retrofit</span> retrofit = new Retrofit.<span class="keyword">Builder() </span> 
    .<span class="keyword">baseUrl(baseUrl);
</span>    .<span class="keyword">addCallAdapterFactory(RxJavaCallAdapterFactory.create())
</span>    .<span class="keyword">addConverterFactory(GsonConverterFactory.create())
</span>    .<span class="keyword">build();</span>
</code></pre><p>具体代码：</p>
<pre><code><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">UserService</span> </span>{  
    <span class="annotation">@POST</span>(<span class="string">"/me"</span>)
    <span class="function">Observable&lt;User&gt; <span class="title">me</span><span class="params">()</span></span>;
}

<span class="comment">// this code is part of your activity/fragment</span>
Observable&lt;User&gt; observable = userService.me();  
observable.observeOn(AndroidSchedulers.mainThread()).subscribe(<span class="keyword">new</span> Subscriber&lt;User&gt;() {  
    <span class="annotation">@Override</span>
    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onCompleted</span><span class="params">()</span> </span>{
        <span class="comment">// handle completed</span>
    }

    <span class="annotation">@Override</span>
    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onError</span><span class="params">(Throwable e)</span> </span>{
        <span class="comment">// handle error</span>
    }

    <span class="annotation">@Override</span>
    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onNext</span><span class="params">(User user)</span> </span>{
        <span class="comment">// handle response</span>
    }
});
</code></pre><h3 id="附加资源">附加资源</h3><ul>
<li><a href="https://www.youtube.com/watch?v=KIAoQbAu3eA" target="_blank" rel="external">Jake Wharton’s talk @ Droidcon NYC 2015 on Retrofit 2</a></li>
<li><a href="https://github.com/square/okhttp/wiki/Interceptors" target="_blank" rel="external">Details on OkHttp interceptors</a></li>
<li><a href="https://github.com/square/retrofit/tree/master/retrofit-converters" target="_blank" rel="external">Retrofit Converters</a></li>
<li><a href="https://github.com/ReactiveX/RxAndroid" target="_blank" rel="external">RxAndroid on GitHub</a></li>
<li><a href="https://github.com/square/retrofit/tree/master/retrofit-adapters" target="_blank" rel="external">Retrofit CallAdapters</a></li>
<li><a href="https://github.com/square/retrofit/blob/master/CHANGELOG.md" target="_blank" rel="external">Retrofit Change Log</a></li>
</ul>
</span>
        
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <header class="post-header">

      
      
        <h1 class="post-title" itemprop="name headline">
          
          
            
              <a class="post-title-link" href="/2015/10/09/Android基础整理/" itemprop="url">
                Android基础整理
              </a>
            
          
        </h1>
      

      <div class="post-meta">
        <span class="post-time">
          發表於
          <time itemprop="dateCreated" datetime="2015-10-09T12:12:33+08:00" content="2015-10-09">
            2015-10-09
          </time>
        </span>

        
          <span class="post-category" >
            &nbsp; | &nbsp; 分類於
            
              <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                <a href="/categories/Android/" itemprop="url" rel="index">
                  <span itemprop="name">Android</span>
                </a>
              </span>

              
              

            
          </span>
        

        
          
            <span class="post-comments-count">
              &nbsp; | &nbsp;
              <a href="/2015/10/09/Android基础整理/#comments" itemprop="discussionUrl">
                <span class="post-comments-count ds-thread-count" data-thread-key="2015/10/09/Android基础整理/" itemprop="commentsCount"></span>
              </a>
            </span>
          
        
      </div>
    </header>

    <div class="post-body">

      
      

      
        
          <span itemprop="articleBody"><h3 id="Intent">Intent</h3><p>####<br>用来启动Activity:</p>
<pre><code><span class="function">startActivity</span>();

<span class="comment">//带返回结果</span>
<span class="function">startActivityForResult</span>();

<span class="comment">//获取返回结果的方法</span>
<span class="function">onActivityResult</span>();
</code></pre><p>用来启动Service:</p>
<pre><code><span class="comment">//启动服务</span>
<span class="function">startService</span>();

<span class="comment">//绑定服务</span>
<span class="function">bindService</span>();
</code></pre><p>传递广播:</p>
<pre><code>sendBroadcast()<span class="comment">;</span>

sendOrderedBroadcast()<span class="comment">;</span>

sendStickyBroadcast()<span class="comment">;</span>
</code></pre></span>
        
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <header class="post-header">

      
      
        <h1 class="post-title" itemprop="name headline">
          
          
            
              <a class="post-title-link" href="/2015/10/08/代码片段/" itemprop="url">
                代码片段
              </a>
            
          
        </h1>
      

      <div class="post-meta">
        <span class="post-time">
          發表於
          <time itemprop="dateCreated" datetime="2015-10-08T13:47:59+08:00" content="2015-10-08">
            2015-10-08
          </time>
        </span>

        
          <span class="post-category" >
            &nbsp; | &nbsp; 分類於
            
              <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                <a href="/categories/Android/" itemprop="url" rel="index">
                  <span itemprop="name">Android</span>
                </a>
              </span>

              
              

            
          </span>
        

        
          
            <span class="post-comments-count">
              &nbsp; | &nbsp;
              <a href="/2015/10/08/代码片段/#comments" itemprop="discussionUrl">
                <span class="post-comments-count ds-thread-count" data-thread-key="2015/10/08/代码片段/" itemprop="commentsCount"></span>
              </a>
            </span>
          
        
      </div>
    </header>

    <div class="post-body">

      
      

      
        
          <span itemprop="articleBody"><h3 id="手机号中自动添加”-“">手机号中自动添加”-“</h3><p>为Edittext添加监听方法</p>
<pre><code>edittext.addTextChangedListener(<span class="keyword">new</span> TextWatcher());
</code></pre><p>TextWatcher接口如下:</p>
<pre><code><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">TextWatcher</span> <span class="keyword">extends</span> <span class="title">NoCopySpan</span></span>{

    <span class="comment">//在字符串s被，从索引start(包含)的字符开始的count个字符，将被长度为after的新文本代替。</span>
    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">beforeTextChanged</span><span class="params">(CharSequence s,<span class="keyword">int</span> start,<span class="keyword">int</span> count, <span class="keyword">int</span> after)</span></span>;

    <span class="comment">//在字符串s内，从索引start(包含)的字符开始count个字符刚刚替换了长度为before的旧字符。</span>
    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onTextChanged</span><span class="params">(CharSequence s, <span class="keyword">int</span> start, <span class="keyword">int</span> before, <span class="keyword">int</span> count)</span></span>;

    <span class="comment">//字符串s内容已经发生了变化</span>
    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">afterTextChanged</span><span class="params">(Editable s)</span></span>;
}
</code></pre><p>具体操作:</p>
<pre><code><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onTextChanged</span><span class="params">(CharSequence s,<span class="keyword">int</span> start,<span class="keyword">int</span> before, <span class="keyword">int</span> count)</span></span>{
    <span class="keyword">if</span>(count == <span class="number">1</span>){
        <span class="keyword">int</span> length = s.toString().length();
        <span class="keyword">if</span>(length == <span class="number">3</span> || length == <span class="number">8</span>){
            editText.setText(s + <span class="string">"-"</span>);
            editText.setSelection(editText.getText().toString().length());
        }
    }
}
</code></pre><h3 id="Handler的优化">Handler的优化</h3><p>在Android应用启动时，framework会为该应用程序的主线程创建一个Lopper对象，这个Lopper对象包含一个简单的消息队列，并且能够循环处理队列中的消息。主线程的Lopper对象会被碎该应用程序的整个生命周期。</p>
<p>造成内存泄漏的原因：只要有未处理的消息，那么该消息就会引用Handler，非静态的Handler又会引用外部类，即Activity，导致Activity无法被回收，造成泄漏。</p>
<p><strong>静态内部类不会持有对外部类的引用</strong></p>
<p>解决方案：</p>
<pre><code>public <span class="class"><span class="keyword">class</span> <span class="title">SampleActivity</span> <span class="keyword"><span class="keyword">extends</span></span> <span class="title">Activity</span>{</span>

    <span class="keyword">private</span> static <span class="class"><span class="keyword">class</span> <span class="title">MyHandler</span> <span class="keyword"><span class="keyword">extends</span></span> <span class="title">Handler</span>{</span>
        <span class="keyword">private</span> <span class="keyword">final</span> <span class="type">WeakReference</span>&lt;<span class="type">SampleActivity</span>&gt; mActivity;

        public <span class="type">MyHandler</span>(<span class="type">SampleActivity</span> activity){
            mActivity = <span class="keyword">new</span> <span class="type">WeakReference</span>&lt;<span class="type">SampleActivity</span>&gt;(activity);
        }

        <span class="annotation">@Override</span>
        public void handleMessage(<span class="type">Message</span> msg){
            <span class="type">SampleActivity</span> activity = mActivity.get();
            <span class="keyword">if</span>(activity != <span class="literal">null</span>){
                <span class="comment">//...</span>
            }
        }
    }

    <span class="keyword">private</span> <span class="keyword">final</span> <span class="type">MyHandler</span> mHandler = <span class="keyword">new</span> <span class="type">MyHandler</span>(<span class="keyword">this</span>);

    <span class="keyword">private</span> static <span class="keyword">final</span> <span class="type">Runnable</span> sRunnable = <span class="keyword">new</span> <span class="type">Runnable</span>(){
        <span class="annotation">@Override</span>
        public void run(){

        }
    }

    <span class="annotation">@Override</span>
    <span class="keyword">protected</span> void onCreate(<span class="type">Bundle</span> savedInstanceState){
        <span class="keyword">super</span>.onCreate(savedInstanceState);

        mHandler.postDelayed(sRunnable,<span class="number">1000</span>*<span class="number">60</span>*<span class="number">10</span>);

        finish();
    }
}
</code></pre><h3 id="实现对隐式Intent的运行时检查">实现对隐式Intent的运行时检查</h3><p>如果想打开相机或者发送图片等隐式Intent，比如说打开相机， 如果手机中不存在相机的话，那么系统就会抛出<strong>ActivityNotFoundException</strong>,如果不做处理的话，程序就会崩溃。所以具体的解决方案是，在使用隐式Intent的时候，首先进行检查，代码如下：</p>
<pre><code><span class="type">Intent</span> <span class="type">intent</span> = new <span class="type">Intent</span>(<span class="type">Intent</span>.Action_XXX);
ComponentName componentName = <span class="type">intent</span>.resolveActivity(getPacakgeManager());
<span class="keyword">if</span>(componentName <span class="comment">!= null){</span>
    String className = component.getClassName();
}
</code></pre><h3 id="使用NotificationCompat兼容包来处理消息通知">使用NotificationCompat兼容包来处理消息通知</h3><pre><code>NotificationCompat.Builder builder = <span class="keyword">new</span> NotificationCompat.Builder(<span class="keyword">this</span>);
builder.setSmallIcon(R.drawable.notification_icon);
<span class="keyword">String</span> <span class="built_in">text</span> = <span class="string">"aaaaa"</span>;
builder.setContentText(<span class="built_in">text</span>);

<span class="comment">//添加点击效果</span>
PendingIntent intent = XXX;
builder.setContentIntent(intent);

<span class="built_in">int</span> <span class="built_in">color</span> = getResources().getColor(R.<span class="built_in">color</span>.black);
builder.setColor(<span class="built_in">color</span>);

<span class="comment">//设置图片</span>
Bitmap bitmap = ...;
builder.setLargeIcon(bitmap);

<span class="comment">//设置样式</span>
builder.setStyle(<span class="keyword">new</span> NotificationCompat.bigTextStyle(<span class="built_in">text</span>));

PendingIntent intent =...;
builder.addAction(mew NotificationCompat.Action(R.drawable.icon,<span class="string">"Mute"</span>,intent));

<span class="comment">//设置穿戴设备的样式</span>
NotificationCompat.WearableExtender wearableExtender = <span class="keyword">new</span> NotificationCompat.WearableExtender();
RemoteInput remoteInput = <span class="keyword">new</span> RemoteInput.Builder(<span class="string">"voice_result_key"</span>).setLabel(<span class="string">"Reply"</span>).build();

wearableExtender.addAction(<span class="keyword">new</span> NotificationCompat.Action.Builder(R.drawable.mute_icon,<span class="string">"Reply"</span>,replyIntent).addRemoteInout(remoteInput).build);
builder.extend(wearableExtender);

Notification notification = builder.build();
NotificationManagerCompat.from(<span class="keyword">this</span>).notify(<span class="number">0</span>,notification);
</code></pre><h3 id="使用Toobar代替ActionBar">使用Toobar代替ActionBar</h3><p>第一步：改变主题为<strong>Theme.AppCompat.NoActionBar</strong></p>
<p>第二步：修改布局文件</p>
<pre><code>&lt;android<span class="class">.support</span><span class="class">.v7</span><span class="class">.widget</span><span class="class">.Toolbar</span>
    android:id=<span class="string">"@+id/id_toolbar"</span>
    android:layout_width=<span class="string">"match_parent"</span>
    android:layout_height＝<span class="string">"wrap_content"</span>
    android:layout_alignParentTop=<span class="string">"true"</span>
    android:minHeight=<span class="string">"?attr.actionBarSize"</span>&gt;
&lt;/android<span class="class">.support</span><span class="class">.v7</span><span class="class">.widget</span><span class="class">.Toolbar</span>&gt;
</code></pre><p>第三步：修改代码</p>
<pre><code><span class="annotation">@Override</span>
<span class="keyword">protected</span> <span class="function"><span class="keyword">void</span> <span class="title">onCreate</span><span class="params">(Bundle savedInstanceState)</span></span>{
    setContentView(R.layout.activity_main);
    Toolbar toolbar = findviewById(R.id.toolbar_layout);
    setSupportActionBar(toolbar);
}
</code></pre><h3 id="参考文章">参考文章</h3><ol>
<li><a href="http://hukai.me/android-dev-patterns/" target="_blank" rel="external">Android开发最佳实践</a></li>
</ol>
</span>
        
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <header class="post-header">

      
      
        <h1 class="post-title" itemprop="name headline">
          
          
            
              <a class="post-title-link" href="/2015/09/24/Touch事件的传递机制/" itemprop="url">
                Touch事件的传递机制
              </a>
            
          
        </h1>
      

      <div class="post-meta">
        <span class="post-time">
          發表於
          <time itemprop="dateCreated" datetime="2015-09-24T15:57:16+08:00" content="2015-09-24">
            2015-09-24
          </time>
        </span>

        
          <span class="post-category" >
            &nbsp; | &nbsp; 分類於
            
              <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                <a href="/categories/Android/" itemprop="url" rel="index">
                  <span itemprop="name">Android</span>
                </a>
              </span>

              
              

            
          </span>
        

        
          
            <span class="post-comments-count">
              &nbsp; | &nbsp;
              <a href="/2015/09/24/Touch事件的传递机制/#comments" itemprop="discussionUrl">
                <span class="post-comments-count ds-thread-count" data-thread-key="2015/09/24/Touch事件的传递机制/" itemprop="commentsCount"></span>
              </a>
            </span>
          
        
      </div>
    </header>

    <div class="post-body">

      
      

      
        
          <span itemprop="articleBody"><p>图示：</p>
<p><img src="https://github.com/zhanfangzxc/zhanfangzxc.github.io/blob/source/source/_posts/Touch%E4%BA%8B%E4%BB%B6%E4%BC%A0%E9%80%92.jpg?raw=true" alt="Touch事件传递"></p>
<p>这篇文章为收集整理别人的内容，所以非常感谢那些默默付出的大牛们，正是有你们的付出，才让我不断的进步，感谢。</p>
<p>以下图片中的黑色箭头为<strong>ACTION_DOWN</strong>事件的分发顺序，绿色箭头是<strong>ACTION_UP</strong>和<strong>ACTION_MOVE</strong>的事件分发顺序。</p>
<h4 id="ViewGroup和View都不消耗事件，最终交给Activity消耗">ViewGroup和View都不消耗事件，最终交给Activity消耗</h4><p><img src="http://fangjie.info/wp-content/uploads/2015/09/view1-1024x629.png" alt="Activity消耗事件"></p>
<p>实际开发中我们经常会<strong>setOnTouchListener</strong>，这个会在<strong>onTouchEvent</strong>之前调用，如果这个方法返回false的话，那么事件会传递到<strong>onTouchEvent</strong>;如果返回true，相当于拦截了事件。</p>
<h4 id="Touch的区域是在ViewGroup之内，View之外">Touch的区域是在ViewGroup之内，View之外</h4><p><img src="http://fangjie.info/wp-content/uploads/2015/09/view2.png" alt="Touch ViewGroup"></p>
<h4 id="View消耗事件">View消耗事件</h4><p><img src="http://fangjie.info/wp-content/uploads/2015/09/view3.png" alt="View消耗事件"></p>
<h4 id="ViewGroup消耗事件，但经过View传递">ViewGroup消耗事件，但经过View传递</h4><p><img src="http://fangjie.info/wp-content/uploads/2015/09/view4.png" alt="ViewGroup消耗事件">      </p>
<h4 id="ViewGroup消耗事件，但是不经过View传递">ViewGroup消耗事件，但是不经过View传递</h4><p><img src="http://fangjie.info/wp-content/uploads/2015/09/view5.png" alt="ViewGroup"></p>
<h4 id="参考文章">参考文章</h4><p>图解View的事件分发机制:<a href="http://fangjie.info/%E5%9B%BE%E8%A7%A3view%E7%9A%84%E4%BA%8B%E4%BB%B6%E5%88%86%E5%8F%91%E6%9C%BA%E5%88%B6/?utm_source=tuicool" target="_blank" rel="external">http://fangjie.info/%E5%9B%BE%E8%A7%A3view%E7%9A%84%E4%BA%8B%E4%BB%B6%E5%88%86%E5%8F%91%E6%9C%BA%E5%88%B6/?utm_source=tuicool</a></p>
</span>
        
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
  </section>

  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/">&laquo;</a><a class="page-number" href="/">1</a><span class="page-number current">2</span><a class="page-number" href="/page/3/">3</a><a class="page-number" href="/page/4/">4</a><a class="extend next" rel="next" href="/page/3/">&raquo;</a>
  </nav>

 </div>

        

        
      </div>

      
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    <div class="sidebar-inner">

      

      <section class="site-overview">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <img class="site-author-image" src="http://img4.duitang.com/uploads/item/201405/07/20140507210553_NQGUP.thumb.600_0.jpeg" alt="坚持远方" itemprop="image"/>
          <p class="site-author-name" itemprop="name">坚持远方</p>
        </div>
        <p class="site-description motion-element" itemprop="description">既然选择远方，便只顾风雨兼程</p>
        <nav class="site-state motion-element">
          <div class="site-state-item site-state-posts">
            <a href="/archives">
              <span class="site-state-item-count">31</span>
              <span class="site-state-item-name">文章</span>
            </a>
          </div>

          <div class="site-state-item site-state-categories">
            <a href="/categories">
              <span class="site-state-item-count">2</span>
              <span class="site-state-item-name">分類</span>
              </a>
          </div>

          <div class="site-state-item site-state-tags">
            <a href="/tags">
              <span class="site-state-item-count">29</span>
              <span class="site-state-item-name">標籤</span>
              </a>
          </div>

        </nav>

        
          <div class="feed-link motion-element">
            <a href="/atom.xml" rel="alternate">
              <i class="menu-item-icon icon-next-feed"></i>
              RSS
            </a>
          </div>
        

        <div class="links-of-author motion-element">
          
            
              <span class="links-of-author-item">
                <a href="https://github.com/zhanfangzxc" target="_blank">GitHub</a>
              </span>
            
              <span class="links-of-author-item">
                <a href="http://weibo.com/5497967279" target="_blank">Weibo</a>
              </span>
            
          
        </div>

        
        

        <div class="links-of-author motion-element">
          
        </div>

      </section>

      

    </div>
  </aside>


    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner"> <div class="copyright" >
  
  &copy; &nbsp; 
  <span itemprop="copyrightYear">2016</span>
  <span class="with-love">
    <i class="icon-next-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">赵珊珊</span>
</div>

<div class="powered-by">
  由 <a class="theme-link" href="http://hexo.io">Hexo</a> 強力驅動
</div>

<div class="theme-info">
  主題 -
  <a class="theme-link" href="https://github.com/iissnan/hexo-theme-next">
    NexT
  </a>
</div>


 </div>
    </footer>

    <div class="back-to-top"></div>
  </div>

  <script type="text/javascript" src="/vendors/jquery/index.js?v=2.1.3"></script>

  
  
  
    

  
    
  

  <script type="text/javascript">
    var duoshuoQuery = {short_name:"zhaoshanshan"};
    (function() {
      var ds = document.createElement('script');
      ds.type = 'text/javascript';ds.async = true;
      ds.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') + '//static.duoshuo.com/embed.js';
      ds.charset = 'UTF-8';
      (document.getElementsByTagName('head')[0]
      || document.getElementsByTagName('body')[0]).appendChild(ds);
    })();
  </script>
    
     

    
  
  
  <script type="text/javascript" src="/vendors/fancybox/source/jquery.fancybox.pack.js"></script>
  <script type="text/javascript" src="/js/fancy-box.js?v=0.4.5.1"></script>


  <script type="text/javascript" src="/js/helpers.js?v=0.4.5.1"></script>
  

  <script type="text/javascript" src="/vendors/velocity/velocity.min.js"></script>
  <script type="text/javascript" src="/vendors/velocity/velocity.ui.min.js"></script>

  <script type="text/javascript" src="/js/motion_global.js?v=0.4.5.1" id="motion.global"></script>




  <script type="text/javascript" src="/js/nav-toggle.js?v=0.4.5.1"></script>
  <script type="text/javascript" src="/vendors/fastclick/lib/fastclick.min.js?v=1.0.6"></script>

  

  <script type="text/javascript">
    $(document).ready(function () {
      if (CONFIG.sidebar === 'always') {
        displaySidebar();
      }
      if (isMobile()) {
        FastClick.attach(document.body);
      }
    });
  </script>

  

  
  

  
  <script type="text/javascript" src="/js/lazyload.js"></script>
  <script type="text/javascript">
    $(function () {
      $("#posts").find('img').lazyload({
        placeholder: "/images/loading.gif",
        effect: "fadeIn"
      });
    });
  </script>
</body>
</html>
